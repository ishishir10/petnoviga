<!DOCTYPE html>
<html>

<head>
    <title>UPS</title>
    <script>
        (function (w, d) {

            if (window._pickupInstance)
                return;

            window._pickupInstance = true;

            var server = window._pickupSettings && window._pickupSettings.server ? window._pickupSettings.server : 'https://www.pickuppoint.co.il';
            var ver = "113.118";
            var service = window._pickupSettings && window._pickupSettings.type ? window._pickupSettings.type : "all";
            var Gmap = {
                init: function () {
                    var _self = this;

                    if (typeof google === 'object' && typeof google.maps === 'object') {
                        if (typeof google.maps.places === 'object') {
                            _self.ready();
                        }
                        else {
                            var ht = document.head;
                            var script = document.createElement("script");
                            script.type = "text/javascript";
                            script.src = "//maps.googleapis.com/maps/api/js?libraries=places&language=he&key=AIzaSyD62c5ORojhBdtNA1glgJfhQkd-y22IMns";
                            script.onload = _self.ready;
                            ht.appendChild(script);
                        }
                    }
                    else {
                        var ht = document.head;
                        var script = document.createElement("script");
                        script.type = "text/javascript";
                        script.src = "//maps.googleapis.com/maps/api/js?libraries=places,geometry&language=he&key=AIzaSyD62c5ORojhBdtNA1glgJfhQkd-y22IMns";
                        script.onload = _self.ready;
                        ht.appendChild(script);
                    }

                },
                ready: function () {

                    var ht = document.head;
                    var script = document.createElement("script");
                    script.type = "text/javascript";
                    script.src = server + "/api/ups-pickups.sdk.dep.js";
                    //script.onload = function (e) { addCSS(server, '/api/pickups.0.5.css'); };
                    script.onload = function (e) { addCSS(server, '/api/pickups.0.5.min.css?rel=' + ver); };
                    ht.appendChild(script);
                }
            }
            if (typeof jQuery == 'undefined' || jQuery.fn.jquery != '2.1.4') {
                try {
                    var jq = document.createElement('script');
                    jq.type = 'text/javascript';

                    jq.src = server + '/api/jquery-2.1.4.min.js';
                    jq.onload = __initjq;
                    document.head.appendChild(jq);
                }
                catch (e) {
                    console.log("Exception: " + e);
                }
            } else {
                $jp = jQuery ? jQuery : window.jQuery;
                ___initjq();
            }
            function __initjq() {
                $jp = jQuery.noConflict(true);
                ___initjq();
            }
            function ___initjq() {
                // Check if script has been loaded to avoid collisions
                /*if ($("script[src*='ups-pickups.sdk.all.js']").length > 1)
                     return;*/

                Gmap.init();
            }

            function addCSS(url, path) {
                var css = document.createElement('link');
                css.rel = 'stylesheet';
                css.href = url + path;
                css.onload = function () { pluginBody($jp, w, d); };
                document.head.appendChild(css);
            }

            function pluginBody($, window, document) {
                var pluginName = "ShopLocator",
                    defaults = {
                        pluginStyle: "cosmic",
                        paginationStyle: 1,
                        preloader: false,
                        json: null,
                        map: {
                            center: [31.9887374, 34.9010247],
                            MapType: google.maps.MapTypeId.ROADMAP, //MapTypeId.ROADMAP, MapTypeId.SATELLITE, MapTypeId.HYBRID, MapTypeId.TERRAIN
                            disableDefaultUI: false,
                            mapStyle: [],
                            draggable: true,
                            disableDoubleClickZoom: false,
                            maxZoom: "",
                            minZoom: "",
                            scrollwheel: true,
                            zoom: 3,
                            allMarkersInViewport: true
                        },
                        infoBubble: {
                            visible: false,
                            padding: 0,
                            borderRadius: 4,
                            borderWidth: 0,
                            borderColor: "#fff",
                            backgroundColor: "#fff",
                            shadowStyle: 0,
                            minHeight: null,
                            maxHeight: 100,
                            minWidth: 200,
                            maxWidth: null,
                            arrowStyle: 0,
                            arrowSize: 10,
                            arrowPosition: 50,
                            hideCloseButton: false,
                            closeSrc: server + "/Content/assets/plugins/shoplocator/closeButton.svg",
                            offsetTop: 2,
                            offsetRight: 2,
                            disableAutoPan: false,
                            //getDirectionsButton: true,
                            //directionsUseGeolocation: true
                        },
                        markersIcon: server + "/Content/assets/plugins/shoplocator/lollipop/images/marker.png",
                        marker: {
                            latlng: [52.2296760, 21.0122290],
                            animation: false, //google.maps.Animation.DROP, google.maps.Animation.BOUNCE
                            //animation: google.maps.Animation.BOUNCE,
                            title: "CreateIT",
                            street: "",
                            zip: "",
                            city: ""
                        },
                        cluster: {
                            enable: false,
                            clusterClass: "cluster",
                            gridSize: 50,
                            maxZoom: 11,
                            style: {
                                anchorIcon: [0, 0],
                                anchorText: [0, 0],
                                backgroundPosition: "0 0",
                                fontFamily: 'Arial,sans-serif',
                                fontStyle: 'normal',
                                textColor: 'white',
                                fontWeight: 'bold',
                                textSize: 18,
                                heightSM: 60,
                                widthSM: 54,
                                heightMD: 60,
                                widthMD: 54,
                                heightBIG: 60,
                                widthBIG: 54,
                                iconSmall: server + "/Content/assets/plugins/shoplocator/lollipop/images/clusterSmall.png",
                                iconMedium: server + "/Content/assets/plugins/shoplocator/lollipop/images/clusterMedium.png",
                                iconBig: server + "/Content/assets/plugins/shoplocator/lollipop/images/clusterBig.png"
                            }
                        },
                        sidebar: {
                            visible: false,
                            selectSection: {
                                visible: false,
                                pathToJSONDirectory: server + "/Home/GetPointsData/",
                                difFiles: [["First Region", "markers"], ["Second Region", "diffmarkers"]],
                                fileTypes: "json"
                            },
                            searchBox: {
                                visible: true,
                                findPlaceBy: "cities",
                                searchByCountry: [false, "us"],
                                search: true,
                                searchRadius: 20,
                                placeHolder: "nheuo akl"
                            },
                            results: {
                                visibleInFirstPage: true,
                                pageSize: 10,
                                currentPage: 1,
                                paginationItems: 5
                            }
                        }
                    };

                var openInfoWindow;

                // The actual plugin constructor
                function Plugin(element, options) {

                    this.block = null;
                    this.modal = null;
                    this.bodySrc = {};
                    // this.element = $('#pickup'); // element;
                    // jQuery has an extend method which merges the contents of two or
                    // more objects, storing the result in the first object. The first object
                    // is generally empty as we don't want to alter the default options for
                    // future instances of the plugin
                    this.settings = $.extend(true, {}, defaults, options);
                    this._defaults = defaults;
                    this._name = pluginName;
                    this._searchInput = null;
                    this._mapCanvas = null;
                    this._infoWindow = null;
                    this._preloader = null;
                    this._markers = null;
                    this._lastZoom = 10;
                    this._lastMarker = null;
                    this._bounds = null;
                    this._isDefaultCalled = false;
                    this.initButton();
                    this._service = "all";
                    this._previousService = "all";
                    this._cluster = null;
                    this._data = [];
                    this._stores = [];
                    this._lockers = [];
                    this._drops = [];
                    this._searchPosition = null;
                    this._homeMarker = null;
                    this._allPoints = null;
                    this._radius = null;
                    this._searchBox = null;
                    this._modalSize = '10%';
                }

                // Avoid Plugin.prototype conflicts
                $.extend(Plugin.prototype, {
                    initButton: function () {
                        var _self = this;
                        this.settings.choose = function (address) {
                            var e = document.createEvent("HTMLEvents");
                            e.initEvent("pickups-after-choosen", false, true);
                            e.detail = address;
                            document.body.dispatchEvent(e);
                            _self.closeModal();
                        }
                    },
                    onClick: function () {
                        var e = document.createEvent("HTMLEvents");
                        e.initEvent("pickups-before-open", false, true);
                        document.body.dispatchEvent(e);
                        this.show();
                    },
                    init: function (service) {

                        this._service = service;

                        this.setUpModalWindow();
                        this.setUpScriptBody(this.element[0], this.settings);
                        this.setUpMap(this.element[0], this.settings);
                    },
                    show: function () {
                        var _self = this;
                        $(window).unbind('resize');
                        $(window).resize(function ($) {
                            _self.calculateSizes(true);
                        });

                        $('body').css({ 'overflow': 'hidden', 'position': 'static', 'width': '100%' });

                        this.block.show();
                        this.modal.show();
                        ///calc search items to fit container only when modal shown                
                        this.calculateSizes();
                        //this.resultsInPage(_self, _self.element[0], _self.settings);

                        this.showMarkers();
                        $('div.pkp-header').show();

                        setTimeout(function () {
                            //window.PickupsSDK.calculateSizes(true);
                            //alway start on full screen
                            _self._modalSize = '10%';
                            _self.resizeModal();
                        }, 300);

                    },
                    closeModal: function () {

                        if (this._homeMarker != null)
                            this._homeMarker.setMap(null);

                        if (this.block == null) return;

                        //if (this._searchBox.getPlace() != null) {
                        $('#searchGmaps').val("");
                        google.maps.event.trigger(this._searchBox, 'place_changed');
                        this._lastZoom = 10;
                        //}


                        this._infoWindow.close();
                        $('body').css({ 'overflow': this.bodySrc.overflow, 'position': this.bodySrc.position });
                        $('body').scrollTop(this.bodySrc.scrollY);
                        $(this.modal).hide();

                        //var _self = this;
                        this.block.fadeOut();
                    },
                    setAddressFromCoord: function (lat, lng, isGPS) {
                        var _self = this;

                        var latlng = new google.maps.LatLng(lat, lng);
                        var rgeocoder = new google.maps.Geocoder();

                        rgeocoder.geocode({ 'location': latlng }, function (results, status) {
                            if (status !== 'OK') {
                                _self.navigateCurrent();
                                return;
                            }

                            var addr = results[0].formatted_address;

                            if (!isGPS && !(addr.includes("Israel") || addr.includes("ישראל"))) {
                                console.log("Out of bounds");
                                _self.navigateCurrent();
                                return;
                            }

                            $('#searchGmaps').val(results[0].formatted_address);
                            _self._mapCanvas.setCenter(latlng);

                            var markerDetails = new Object();

                            markerDetails.getPlace = function () {
                                var position = new Object();
                                position.geometry = new Object();
                                position.geometry.location = new Object();
                                position.geometry.location.lat = function () { return lat };
                                position.geometry.location.lng = function () { return lng };
                                position.name = $('#searchGmaps').val();
                                return position;
                            };

                            _self._homeMarker = _self.createMarkers(_self._mapCanvas, null, markerDetails, _self.settings, true);
                            _self.setSearchPosition(lat, lng);
                        });
                    },
                    setDefaults: function (json) {
                        var _self = this;
                        _self._isDefaultCalled = true;

                        if (json) {
                            var address = JSON.parse(json);

                            if (typeof (address.location) == 'object') {
                                // navigate by GPS point
                                if (typeof (address.location.lat) == 'number' && typeof (address.location.lng) == 'number') {
                                    _self.setAddressFromCoord(address.location.lat, address.location.lng, false);
                                } else {

                                    address.location.city = (typeof (address.location.city) == 'string') ? address.location.city.trim() : "";
                                    address.location.street = (typeof (address.location.street) == 'string') ? address.location.street.trim() : "";
                                    address.location.house = (typeof (address.location.house) != 'undefined') ? address.location.house.trim() : "";

                                    // if (address.location.city.length > 0) trackEvents("Default Address", address.location.city, address.location.street + ((address.location.house.length > 0) ? " " + address.location.house : ""));

                                    var request = address.location.city;
                                    if (request.length > 0 && address.location.street.length > 0) {
                                        var street = address.location.street;

                                        if (address.location.house.length > 0) {
                                            street += " " + address.location.house;
                                        }
                                        request = street + ", " + request;
                                    }


                                    if (request.length > 0) {

                                        geocoder = new google.maps.Geocoder();
                                        geocoder.geocode({ 'address': request }, function (results, status) {
                                            if (status == google.maps.GeocoderStatus.OK) {
                                                var lt = results[0].geometry.location.lat();
                                                var lg = results[0].geometry.location.lng();
                                                var address = results[0].formatted_address;

                                                if (!(address.includes("Israel") || address.includes("ישראל"))) {
                                                    _self.navigateCurrent();
                                                    return;
                                                }
                                                _self.setSearchPosition(lt, lg, address);

                                                var markerDetails = new Object();
                                                markerDetails.getPlace = function () {
                                                    var position = new Object();
                                                    position.geometry = new Object();
                                                    position.geometry.location = new Object();
                                                    position.geometry.location.lat = function () { return lt };
                                                    position.geometry.location.lng = function () { return lg };
                                                    position.name = address;
                                                    return position;
                                                };

                                                _self._homeMarker = _self.createMarkers(_self._mapCanvas, null, markerDetails, _self.settings, true);
                                            } else {
                                                _self.navigateCurrent();
                                            }
                                        });
                                    }
                                    else {
                                        _self.navigateCurrent();
                                    }

                                }
                            }
                            else {
                                _self.navigateCurrent();
                            }
                        }
                        else {
                            _self.navigateCurrent();
                        }
                    },
                    navigateCurrent: function () {
                        var _self = this;
                        if (navigator.geolocation) {
                            navigator.geolocation.getCurrentPosition(function (position) {
                                _self.setAddressFromCoord(position.coords.latitude, position.coords.longitude, true);
                                _self.setSearchPosition(position.coords.latitude, position.coords.longitude);
                            }, function () {
                            });
                        } else {
                            // Browser doesn't support Geolocation
                            console.log("Error: Your browser doesn't support geolocation.")
                        }
                    },
                    showModalWindow: function () {
                    },
                    setUpModalWindow: function () {
                        var _self = this;

                        if ($('div.pickups-block').length > 0) {
                            if (typeof (_self.element) == "undefined") {
                                $('div.pickups-block').remove();
                                $('#pickups_body').remove();

                            } else return;
                        }


                        if ($('#pickups_body').length > 0) {
                            this.element = $('#pickups_body');
                            return;
                        }

                        this.bodySrc.overflow = $('body').css('overflow');
                        this.bodySrc.position = $('body').css('position');
                        this.bodySrc.scrollY = $('body').scrollTop();


                        var h = $(window).height();
                        var w = $(window).width();

                        this.block = $('<div class="pickups-block"><div class="row-pickups"></div></div>');
                        this.modal = $('<div class="pickups-modal"><div class="pkp-header"><span><a id="pickupbtnmn" class="pickup_close" onclick="window.PickupsSDK.closeModal();" >×</a><a class="changeSize" onclick="window.PickupsSDK.resizeModal();"><img src="' + server + '/api/icons/icon_22x22_resize_maximize.png" /></a></span><h4 style="direction:rtl">שירות PickUp - אוספים את המשלוח בדרך הביתה</h4></div><div id="pickups_body"></div></div>');

                        $('body').append(this.modal);
                        $('body').append(this.block);

                        this.block.css({
                            'position': 'fixed',
                            'top': '0',
                            'left': '0',
                            'right': '0',
                            'bottom': '0',
                            'background-color': 'rgba(0,0,0,0.6)',
                            'z-index': '1',
                            'display': 'none',
                            'overflow': 'hidden',
                            'flex-direction': 'column'
                        });

                        var modalCss = {
                            'position': 'fixed',   // relative	// absolute   
                            'background-color': '#fff',
                            'border': '0 solid #8dc642',
                            'margin': 'auto',
                            '-webkit-transition': 'all 0.5s ease',
                            'transition': 'all 0.3s ease',
                            'z-index': '99999999999',
                            '-webkit-border-radius': '1px',
                            '-webkit-box-shadow': '-1px 2px 24px rgba(0, 0, 0, 0.91)',
                            '-webkit-overflow-scrolling': 'touch',
                            'display': 'none',
                            'overflow': 'hidden'
                        };

                        //this.resizeModal();
                        this.modal.css(modalCss);
                        this.element = $('#pickups_body');
                    },
                    calculate5kmZoom: function () {
                        var area = Math.min($('#map_canvas').height(), $('#map_canvas').width()); //Get smallest pixel area
                        var zoom = 14 - Math.ceil((Math.log(5) * 496 / area) / Math.log(2));
                        return zoom;
                    },
                    calculateSizes: function (resizeMap) {
                        var modal_height = window.innerHeight;
                        var modal_width = window.innerWidth;
                        var reduction, map_reduction;
                        //var itemHeight = 0;

                        if (this._modalSize == '10%') {
                            modal_width *= 0.8;
                            modal_height *= 0.8;
                        }

                        if (window.innerWidth < 1024) {
                            reduction = $('.ct-googleMap--searchContainer').outerHeight() +
                                $('.ct-googleMap--searchContainer+nav').outerHeight() +
                                $('.ct-googleMap--sidebar .Navigation').outerHeight() + 50;

                            //Mobile
                            if (window.innerWidth > window.innerHeight) //Landscape
                            {//reduction = 200;
                            }
                            else {
                                //reduction = 235;
                                $('#infoBubbleContent').css('min-height', 'auto');
                            } //Header, input and title

                            //if (window.innerWidth < window.innerHeight) //Portrait
                            //    itemHeight = 25;

                            $('.ct-googleMap--MapCol').css('width', '100%');
                            $('.ct-googleMap--SidebarCol').css('width', '100%');

                        } else {
                            //Desktop

                            reduction = $('.ct-googleMap--searchContainer').outerHeight() + $('.pkp-header').outerHeight() + 90;
                            //reduction = 225;

                            var sideBar_width = Math.min(Math.max(modal_width * 0.25, 350), modal_width * 0.4);

                            $('.ct-googleMap--MapCol').css('width', modal_width - sideBar_width);
                            $('.ct-googleMap--SidebarCol').css('width', sideBar_width);
                        }

                        map_reduction = reduction - 70;
                        var section_height = modal_height - reduction + ((window.innerWidth > innerHeight) ? 25 : 0) - 46;
                        var activePageClass = '.page' + $('.NavPage.active').attr('rel');
                        var titleHeight = $(activePageClass + ' .ct-googleMap--sidebarItemTitle').height();

                        if (titleHeight == null)
                            titleHeight = $('.ct-googleMap--sidebarItemTitle').height();
                        ///check max number of elements in single page
                        var resultContainer = $('.ct-googleMap--results');
                        var itemHeight = resultContainer.find('.ct-googleMap--sidebarItem:first-child').outerHeight(true);
                        if (itemHeight) {
                            var pageSize = parseInt(resultContainer.height() / itemHeight);
                            if (pageSize != this.settings.sidebar.results.pageSize) {
                                this.settings.sidebar.results.pageSize = parseInt(resultContainer.height() / itemHeight);
                                this.resultsInPage(this, this.element[0], this.settings);
                            }
                        }

                        if (this._mapCanvas && resizeMap) {
                            var context = this;
                            setTimeout(function () {
                                var cent = context._mapCanvas.getCenter();
                                google.maps.event.trigger(context._mapCanvas, "resize");
                                context._mapCanvas.setCenter(cent);
                            }, 250);
                        }
                    },
                    getPointType: function (id) {
                        var type = 'store';
                        if (id) {
                            if (id.startsWith("PKPL")) {
                                type = 'locker';
                            }
                            else if (id.startsWith("PKPD")) {
                                type = 'drop';
                            }
                        }
                        return type;
                    },
                    getPointTypeByData: function (data) {
                        if (data.type) {
                            return data.type;
                        } else {
                            var type = 'store';
                            if (data.iid) {
                                if (data.iid.startsWith("PKPL")) {
                                    type = 'locker';
                                }
                                else if (data.iid.startsWith("PKPD")) {
                                    type = 'drop';
                                }
                            }
                            data.type = type;
                            return type;
                        }
                    },
                    resizeModal: function () {
                        var add_css;

                        switch (this._modalSize) {
                            case '10%':
                                add_css =
                                {
                                    'left': '0',
                                    'right': '0',
                                    'top': '0',
                                    'bottom': '0',
                                    //'max-height': '100vh'
                                }
                                $('.changeSize img').attr('src', server + '/api/icons/icon_22x22_resize_minimize.png');
                                this._modalSize = '0';
                                break;
                            case '0':
                                add_css =
                                {
                                    'left': '10%',
                                    'right': '10%',
                                    'top': '10%',
                                    'bottom': '10%'
                                }
                                $('.changeSize img').attr('src', server + '/api/icons/icon_22x22_resize_maximize.png');
                                this._modalSize = '10%';
                                break;
                        }

                        $('.pickups-modal').css(add_css);

                        this.calculateSizes(true);
                    },
                    //Prepares DOM body for plugin elements
                    setUpScriptBody: function (element, settings) {
                        var _self = this;
                        var sidebarBody;
                        $(element).addClass(settings.pluginStyle);
                        if (settings.sidebar.visible == true) {
                            var logo = '';
                            if (this._service == 'drops') {
                                logo = server + "/api/icons/pickup_drop-off_logo_white.png"
                            }
                            else {
                                logo = server + "/api/icons/logo-blue-bg-big.png"
                            }
                            $('#pickups_body').append("<div class='ct-googleMap--searchContainer' style='background-image: url(\"" + logo + "\");'><input type='text' class='ct-googleMap--search' id='searchGmaps'  placeholder='" + settings.sidebar.searchBox.placeHolder + "' style='background-image: url(" + server + "/api/icons/icon-search.png);' />\
                <div id='map_selection_toggles' style='height: 32px'>" +

                                ((this._service == 'all') ? "<div>" +
                                    "<input  style='margin-left: 5px;' value='all' class='subservice selecteds' id='allpoints' type='radio' checked='1' />" +
                                    "<label for='allpoints'>הכל</label></div>" +

                                    "<div>" +
                                    "<input value='stores' class='subservice' id='pickuppopints' type='radio' />\
                <div><img style='margin: 0 5px;' src='" + server + "/api/icons/icon_18x18_x3_store_white.png' height='18' width='18' /></div>" +
                                    "<label for='pickuppopints'>חנויות</label></div>" +

                                    "<div>" +
                                    "<input value='lockers' class='subservice' id='lockerpoints' type='radio' />\
                <div><img style='margin: 0 5px;' src='" + server + "/api/icons/icon_18x18_x3_locker_white.png' /></div>" +
                                    "<label for='lockerpoints'>לוקרים</label></div>" +

                                    "</div>" : "") +
                                "</div>");

                            var pickup_tabs = "\
                    <nav>\
                        <ul class='pickup-btn-tabs'>\
                            <li role='presentation' onClick='' class='active point_list'>רשימה</li>\
                            <li role='presentation' onClick='' class='point_map'>מפה</li>\
                        </ul>\
                    </nav>";

                            var pickup_content = "\
                    <div class='ct-googleMap--Points'>\
                        <div class='ct-googleMap--SidebarCol'>\
                            <div class='ct-googleMap--sidebar'>\
                            </div>\
                        </div>\
                        <div class='ct-googleMap--MapCol'>\
                            <div class='ct-googleMap ct-js-googleMap' id='map_canvas'>\
                            </div>\
                        </div>\
                    </div>";

                            $('#pickups_body').append(pickup_tabs + pickup_content);


                            $('.point_list').on('click', function () {

                                $(this).addClass('active');
                                $('.point_map').removeClass('active');

                                $('.ct-googleMap--SidebarCol').css('z-index', 1);
                                $('.ct-googleMap--MapCol').css('z-index', 0);
                            });

                            $(document).on('click', '.pickup-showinmap,.point_map', function () {
                                $('.point_map').addClass('active');
                                $('.point_list').removeClass('active');

                                $('.ct-googleMap--SidebarCol').css('z-index', 0);
                                $('.ct-googleMap--MapCol').css('z-index', 1);
                            });
                            $('.point_list').trigger('click');

                            sidebarBody = $(element).find('.ct-googleMap--sidebar');
                            if (settings.sidebar.selectSection.visible == true) {

                                if (this._service == "all")
                                    sidebarBody.append("");


                                sidebarBody.append("<div class='ct-googleMap--selectContainer''>" + "<select class='ct-googleMap--select' style='display: none'></select>" + "</div>");

                                this.createSelectSection(element, settings);

                                $("input.subservice").on("change", function () {

                                    $("input.selecteds").removeAttr("checked").removeAttr("disabled").removeClass("selecteds");
                                    _self._previousService = _self._service;
                                    _self._service = $(this).val();
                                    $(this).attr("checked", "1").addClass("selecteds");

                                    _self.resetByService();

                                });
                            }
                            if (settings.sidebar.searchBox.visible == true || settings.sidebar.searchBox.search == true) {

                                if (settings.sidebar.searchBox.search == true) {

                                    sidebarBody.append("<div class='ct-googleMap--resultsCounter'></div>" + "<div class='ct-googleMap--results ct-googleMap--results-loader'></div>");

                                } else if (settings.sidebar.results.visibleInFirstPage == true) {
                                    sidebarBody.append("<div class='ct-googleMap--results'></div>")
                                }
                            }
                            $(window).unbind('resize');
                            $(window).resize(function ($) {
                                _self.calculateSizes(true);
                            });
                        } else {
                            element.innerHTML = "<div class='ct-googleMap ct-js-googleMap' id='map_canvas'>";
                        }
                    },
                    resetByService: function () {
                        //console.time('resetByService');
                        _self = this;
                        //console.time('filterMarkers');
                        switch (_self._service) {
                            case "all":
                                switch (_self._previousService) {
                                    case "lockers": $.each(this._stores, function (i, o) { _self._cluster.addMarker(o); }); break;
                                    case "stores": $.each(this._lockers, function (i, o) { _self._cluster.addMarker(o); }); break;
                                    case "drops": $.each(this._drops, function (i, o) { _self._cluster.addMarker(o); }); break;
                                }
                                break;
                            case "lockers":
                                _self._cluster.clearMarkers();
                                $.each(this._lockers, function (i, o) { _self._cluster.addMarker(o); });
                                break;
                            case "stores":
                                _self._cluster.clearMarkers();
                                $.each(this._stores, function (i, o) { _self._cluster.addMarker(o); });
                                break;
                            case "drops":
                                _self._cluster.clearMarkers();
                                $.each(this._drops, function (i, o) { _self._cluster.addMarker(o); });
                                break;
                        }
                        //console.timeEnd('filterMarkers');
                        var sidebarItem = $(this.element[0]).find('.ct-googleMap--sidebarItem');
                        var resultsCounter = $(this.element[0]).find('.ct-googleMap--resultsCounter');
                        sidebarItem.remove();
                        var r = $(this.element[0]).find('.ct-googleMap--results');
                        r.addClass("ct-googleMap--results-loader");
                        //console.time('showSearchResult');
                        this.showSearchResult(_self, _self.searchBox, _self._data, _self._markers, this.element[0], this._mapCanvas, this._bounds, this.settings);
                        //console.timeEnd('showSearchResult');

                        r.removeClass("ct-googleMap--results-loader");
                        //console.timeEnd('resetByService');
                    },
                    startByService: function (service) {
                        _self = this;
                        if (!service || service == '') {
                            service = 'all';
                        }
                        var clearClusterer = true;
                        var gmarkers = [];
                        if (_self._service != service) {
                            _self._markers = null;
                            _self._service = service;
                            _self.refetchData(_self, _self.element[0], _self._mapCanvas, _self._bounds, _self.settings, clearClusterer, gmarkers);
                        }
                        //_self.resetByService();
                        if (service != 'all') {
                            $('#map_selection_toggles div').hide();
                        } else {
                            $('#map_selection_toggles div').show();
                        }
                    },
                    //Create map with added options, call marker function
                    setUpMap: function (element, settings) {
                        var selectorMap = $(element).find('.ct-js-googleMap');

                        var infoWindow, mapCanvas1, bounds, draggable;
                        if (window.screen.width < 998) {
                            draggable = true
                        } else {
                            draggable = settings.map.draggable
                        }
                        this._lastMarker = new google.maps.LatLng(settings.map.center[0], settings.map.center[1]);
                        this._mapCanvas = new google.maps.Map(selectorMap[0], {
                            center: new google.maps.LatLng(settings.map.center[0], settings.map.center[1]),
                            mapTypeId: settings.map.MapType,
                            mapTypeControl: false,
                            streetViewControl: false,
                            styles: settings.map.mapStyle,
                            disableDefaultUI: settings.map.disableDefaultUI,
                            draggable: draggable,
                            disableDoubleClickZoom: settings.map.disableDoubleClickZoom,
                            maxZoom: settings.map.maxZoom,
                            minZoom: settings.map.minZoom,
                            scrollwheel: settings.map.scrollwheel,
                            zoom: settings.map.zoom
                        });

                        var _context = this;
                        google.maps.event.addListenerOnce(_context._mapCanvas, 'idle', function () { google.maps.event.trigger(_context._mapCanvas, 'resize'); });


                        if (settings.infoBubble.visible == true) {
                            infoWindow = new google.maps.InfoWindow();
                            this._infoWindow = infoWindow;
                        }

                        //Mapping markers on the map
                        bounds = new google.maps.LatLngBounds();
                        this._bounds = bounds;
                        this.displayMarkers(this, element, this._mapCanvas, bounds, settings);
                    },
                    showSearchResult: function (constructor, searchBox, data, arrayMarker, element, map, bounds, settings) {
                        var _self = this;
                        var dataMarkers, marker, cluster, clusterStyles, clusterOptions;

                        arrayMarker = [];
                        dataMarkers = data;
                        //this._bounds = new google.maps.LatLngBounds();

                        if (searchBox)
                            this.searchBox = searchBox;

                        var filterKey = '';
                        if (this._service == "lockers") {
                            filterKey = 'PKPL';
                        } else if (this._service == "stores") {
                            filterKey = 'PKPS';
                        }
                        else if (this._service == "drops") {
                            filterKey = 'PKPD';
                        }
                        var showedMarkers = [];
                        for (var i = 0; dataMarkers.length > i; i++) {
                            var e = dataMarkers[i];
                            if (e.stat == false) {
                                continue;
                            }
                            else {
                                if (filterKey == '' && e.iid.indexOf("PKPD") === 0) {
                                    continue;
                                } else if (e.iid.indexOf(filterKey) !== 0) {
                                    continue;
                                }
                            }

                            if (settings != null && settings.sidebar.visible == true && settings.sidebar.results.visibleInFirstPage == true) {
                                if (i != 0 && dataMarkers[i].dist > _self._radius) {
                                    break;
                                }
                                if (_self._markers) {
                                    var marker = _self._markers.find(function (m) { return m.pickupData.iid === dataMarkers[i].iid; });
                                    if (marker) {
                                        marker.pickupData = e;
                                        showedMarkers.push(marker);
                                    }
                                }
                            }
                        }
                        constructor.createSidebarItems(_self._mfapCanvas, showedMarkers, element, settings);

                        this.calculateSizes();
                        constructor.resultsInPage(constructor, element, settings);

                        if (settings.map.allMarkersInViewport == true && self._markers != null) {

                            _self._lastMarker = new google.maps.LatLng(dataMarkers[0].lat, dataMarkers[0].lng);
                            _self.showMarkers();
                        }

                        if (_self._markers == null) _self._markers = arrayMarker;

                        return cluster
                    },
                    //JSon function for different files
                    JSonMainFunction: function (constructor, searchBox, data, arrayMarker, element, map, bounds, settings) {
                        var _self = this;
                        var clearClusterer;
                        var dataMarkers, marker, cluster, clusterStyles, clusterOptions;
                        //var gmarkers = [];
                        clusterStyles = [
                            {
                                anchorIcon: settings.cluster.style.anchorIcon,
                                anchorText: settings.cluster.style.anchorText,
                                backgroundPosition: settings.cluster.style.backgroundPosition,
                                fontFamily: settings.cluster.style.fontFamily,
                                fontStyle: settings.cluster.style.fontStyle,
                                textColor: settings.cluster.style.textColor,
                                fontWeight: settings.cluster.style.fontWeight,
                                textSize: settings.cluster.style.textSize,
                                url: settings.cluster.style.iconSmall,
                                height: settings.cluster.style.heightSM,
                                width: settings.cluster.style.widthSM
                            },
                            {
                                anchorIcon: settings.cluster.style.anchorIcon,
                                anchorText: settings.cluster.style.anchorText,
                                backgroundPosition: settings.cluster.style.backgroundPosition,
                                fontFamily: settings.cluster.style.fontFamily,
                                fontStyle: settings.cluster.style.fontStyle,
                                textColor: settings.cluster.style.textColor,
                                fontWeight: settings.cluster.style.fontWeight,
                                textSize: settings.cluster.style.textSize,
                                url: settings.cluster.style.iconMedium,
                                height: settings.cluster.style.heightMD,
                                width: settings.cluster.style.widthMD
                            },
                            {
                                anchorIcon: settings.cluster.style.anchorIcon,
                                anchorText: settings.cluster.style.anchorText,
                                backgroundPosition: settings.cluster.style.backgroundPosition,
                                fontFamily: settings.cluster.style.fontFamily,
                                fontStyle: settings.cluster.style.fontStyle,
                                textColor: settings.cluster.style.textColor,
                                fontWeight: settings.cluster.style.fontWeight,
                                textSize: settings.cluster.style.textSize,
                                url: settings.cluster.style.iconBig,
                                height: settings.cluster.style.heightBIG,
                                width: settings.cluster.style.widthBIG
                            }
                        ];
                        clusterOptions = {
                            clusterClass: settings.cluster.clusterClass,
                            gridSize: settings.cluster.gridSize,
                            maxZoom: settings.cluster.maxZoom,
                            styles: clusterStyles
                        };

                        //$(element).find('.ct-googleMap--search').val('');
                        arrayMarker = [];
                        dataMarkers = data;
                        this._bounds = new google.maps.LatLngBounds();

                        //console.time("filteredDataMarkers");

                        var filterKey = '';
                        if (this._service == "lockers") {
                            filterKey = 'PKPL';
                        } else if (this._service == "stores") {
                            filterKey = 'PKPS';
                        }
                        else if (this._service == "drops") {
                            filterKey = 'PKPD';
                        }

                        for (var i = 0; dataMarkers.length > i; i++) {
                            var e = dataMarkers[i];
                            if (e.stat == false) {
                                continue;
                            }
                            else {
                                if (filterKey == '' && e.iid.indexOf("PKPD") === 0) {
                                    continue;
                                } else if (e.iid.indexOf(filterKey) !== 0) {
                                    continue;
                                }
                            }

                            if (_self._markers == null) {
                                marker = constructor.createMarkers(_self._mapCanvas, searchBox, dataMarkers[i], settings, false);
                                _self._bounds.extend(marker.getPosition());
                                arrayMarker.push(marker);
                            }
                        }

                        //console.timeEnd("filteredDataMarkers");

                        constructor.createSidebarItems(_self._mapCanvas, arrayMarker, element, settings);


                        ///calc search items to fit container only when not modal
                        if ($('#pickups_body').length > 0) {
                            this.calculateSizes();
                            constructor.resultsInPage(constructor, element, settings);
                        }

                        if (settings.cluster.enable == true && _self._markers == null) {
                            clearClusterer = true;
                            cluster = new MarkerClusterer(_self._mapCanvas, arrayMarker, clusterOptions);
                        }
                        else cluster = constructor._cluster;

                        // some logic
                        if (settings.map.allMarkersInViewport == true && self._markers != null) {

                            _self._lastMarker = new google.maps.LatLng(dataMarkers[0].lat, dataMarkers[0].lng);
                            _self.showMarkers();
                        }

                        if (_self._markers == null) _self._markers = arrayMarker;

                        if (_self._lockers.length == 0)
                            $.each(_self._markers, function (i, o) {
                                if (o.pickupData.iid.startsWith("PKPL")) {
                                    _self._lockers.push(o);
                                }
                                else if (o.pickupData.iid.startsWith("PKPD")) {
                                    _self._drops.push(o);
                                }
                                else if (o.pickupData.iid.startsWith("PKPS")) {
                                    _self._stores.push(o);
                                }
                                else {
                                    console.log(o.pickupData.iid);
                                }
                            });

                        return cluster
                    },
                    showMarkers: function (markers) {
                        _self = this;
                        window.setTimeout(function () {
                            _self._mapCanvas.setZoom(_self._lastZoom);
                            google.maps.event.trigger(_self._mapCanvas, 'resize');
                            _self._mapCanvas.setCenter(_self._lastMarker);

                        }, 100);
                    },
                    setSearchPosition: function (lat, lng, formatted_address) {
                        var selectDOM, bounds, sidebarItem, selectValue, marker, cluster, clearClusterer, searchBox, optionsSearchBox;

                        sidebarItem = $(this.element).find('.ct-googleMap--sidebarItem');
                        sidebarItem.remove();

                        var searchLocationPosition = new google.maps.LatLng(lat, lng);

                        //bounds = new google.maps.LatLngBounds();
                        this.performLocationSearch(searchLocationPosition, this, this.element, this.settings.sidebar.searchBox, selectDOM, this._mapCanvas, bounds, this.settings);

                        if (typeof (formatted_address) == 'string') $(this.element).find('.ct-googleMap--search').val(formatted_address);
                    },
                    performLocationSearch: function (searchLocationPosition, constructor, element, searchBox, selectDOM, map, bounds, settings) {
                        var context = this;
                        var _self = constructor;
                        var gmarkers = [], clearClusterer = false;
                        //var cluster;
                        var results = $(this.element).find('.ct-googleMap--results');
                        results.addClass("ct-googleMap--results-loader");
                        if (searchLocationPosition == "Init")
                            searchLocationPosition =
                            {
                                lat: function () { return context.settings.map.center[0] },
                                lng: function () { return context.settings.map.center[1] },
                                center: true
                            };
                        var options = {
                            lat: searchLocationPosition.lat(),
                            lng: searchLocationPosition.lng()
                        };
                        if (this._service == 'drops') {
                            options.types = '4';
                        }
                        //else if (this._service == 'stores') {
                        //    options.types = '1';
                        //}
                        //else if (this._service == 'lockers') {
                        //    options.types = '2';
                        //}
                        $.post(server + "/Home/PostFreeText",
                            options,
                            function (data) {

                                _self._data = data;
                                var dataToSend = [];
                                _self._searchPosition = searchLocationPosition;

                                if (searchLocationPosition.center == true) {
                                    dataToSend = _self._allPoints;
                                    window.setTimeout(function () { _self._mapCanvas.setZoom(10); }, 101);
                                } else {
                                    dataToSend = _self._data;
                                    _self._mapCanvas.setZoom(_self.calculate5kmZoom());
                                    //_self._mapCanvas.setZoom(14);
                                }

                                _self.showSearchResult(_self, searchBox, dataToSend, gmarkers, element, map, bounds, settings);
                                results.removeClass("ct-googleMap--results-loader");
                            }
                        );


                        _self._lastMarker = new google.maps.LatLng(searchLocationPosition.lat(), searchLocationPosition.lng());
                        _self._lastZoom = 12;
                        _self.showMarkers();
                    },
                    placeChanged: function (constructor, element, map, settings, searchBox, selectDOM, bounds) {

                        $('#infoBubbleSpan').html("<br />אתה נמצא ב:<br/><br/>" + $('#searchGmaps').val());
                        var selectDOM, sidebarItem, selectValue, marker, clearClusterer, searchBox, optionsSearchBox;

                        sidebarItem = $(element).find('.ct-googleMap--sidebarItem');
                        sidebarItem.remove();

                        selectValue = selectDOM.val();

                        $(element).find('.ct-googleMap--resultsCounter').html('');
                        if (settings.preloader == true) {
                            var $preloader = $(element).find('.ct-preloader');
                            $preloader.removeClass('make-hidden');
                        }

                        var place = searchBox.getPlace();
                        var sb = $('#searchGmaps');
                        if (place.geometry == null || sb.val() == "")
                            if (place.name == "" || sb.val() == "") {
                                this._homeMarker = null;
                                constructor.performLocationSearch("Init", constructor, element, searchBox, selectDOM, map, bounds, settings);
                            }
                            else console.log("There was an error: ", place);
                        else {
                            var searchLocationPosition = new google.maps.LatLng(place.geometry.location.lat(), place.geometry.location.lng());

                            this._homeMarker = this.createMarkers(this._mapCanvas, null, searchBox, settings, true);
                            this._homeMarker.title = $('#searchGmaps').val();
                            constructor.performLocationSearch(searchLocationPosition, constructor, element, searchBox, selectDOM, map, bounds, settings);
                        }
                    },

                    //Add markers to map
                    displayMarkers: function (constructor, element, map, bounds, settings) {
                        var _self = this;
                        var gmarkers = [];
                        var selectDOM, sidebarItem, selectValue, marker, clearClusterer, searchBox, optionsSearchBox;
                        selectDOM = $(element).find('.ct-googleMap--select');
                        if (settings.preloader == true) {
                            var $preloader = $(element).find('.ct-preloader');
                            this._preloader = $preloader;
                        }
                        if (settings.sidebar.searchBox.visible == true || settings.sidebar.searchBox.search == true) {

                            if (settings.sidebar.searchBox.searchByCountry[0] == true) {
                                optionsSearchBox = {
                                    types: ["(" + settings.sidebar.searchBox.findPlaceBy + ")"],
                                    componentRestrictions: { country: settings.sidebar.searchBox.searchByCountry[1] }
                                };
                            } else {
                                optionsSearchBox = {
                                    types: ["(" + settings.sidebar.searchBox.findPlaceBy + ")"]
                                };
                            }

                            // Create the search box and link it to the UI element.
                            if (constructor._searchInput == null) {
                                constructor._searchInput = $(element).find('.ct-googleMap--search');
                                constructor._searchInput.on("click", function () {
                                    $(this).select();
                                });

                                //var myPosition = [];
                                // searchBox = new google.maps.places.Autocomplete(constructor._searchInput[0]);

                                var searchBoxInput = document.getElementById('searchGmaps');
                                searchBox = new google.maps.places.Autocomplete(searchBoxInput, {
                                    fields: ["name", "geometry.location", "place_id"]
                                });
                                this._searchBox = searchBox;

                                //Add listener to the input for autocomplete and search.
                                (function pacSelectFirst(input) {
                                    // store the original event binding function
                                    var _addEventListener = (input.addEventListener) ? input.addEventListener : input.attachEvent;
                                    function addEventListenerWrapper(type, listener) {
                                        // Simulate a 'down arrow' keypress on hitting 'return' when no pac suggestion is selected,
                                        // and then trigger the original listener.
                                        if (type == "keydown") {
                                            var orig_listener = listener;
                                            listener = function (event) {
                                                var suggestion_selected = $(".pac-item-selected").length > 0;
                                                if (event.which == 13 && !suggestion_selected) {
                                                    var simulated_downarrow = $.Event("keydown", { keyCode: 40, which: 40 })
                                                    orig_listener.apply(input, [simulated_downarrow]);
                                                }

                                                orig_listener.apply(input, [event]);
                                            };
                                        }

                                        // add the modified listener
                                        _addEventListener.apply(input, [type, listener]);
                                    }

                                    if (input.addEventListener)
                                        input.addEventListener = addEventListenerWrapper;
                                    else if (input.attachEvent)
                                        input.attachEvent = addEventListenerWrapper;

                                })(searchBoxInput);

                                google.maps.event.addListener(searchBox, 'place_changed', function (e) {
                                    var place = searchBox.getPlace();
                                    if (!place)
                                        return;

                                    if (_self._homeMarker != null)
                                        if ($('#searchGmaps').val() == "") {

                                            _self._homeMarker.setMap(null);

                                            this._searchPosition = null;
                                        } else {
                                            var pos = place.geometry.location;
                                            var latlng = new google.maps.LatLng(pos.lat(), pos.lng());
                                            _self._homeMarker.setPosition(latlng);
                                            _self._homeMarker.pickupData.lat = pos.lat();
                                            _self._homeMarker.pickupData.lng = pos.lng();
                                        }

                                    constructor.placeChanged(constructor, element, map, settings, searchBox, selectDOM, bounds);
                                });
                            }

                        }
                        if (settings.sidebar.selectSection.visible == true && settings.sidebar.visible == true) {

                            $(selectDOM)
                                .change(function () {
                                    $(this).find('option:selected').each(function () {
                                        _self.refetchData(constructor, element, map, bounds, settings, clearClusterer, gmarkers);
                                    })
                                })
                                .trigger("change");

                        } else {

                            if (settings.json == null) {
                                var singleMarker = [
                                    { "lat": settings.marker.latlng[0], "lng": settings.marker.latlng[1], "title": settings.marker.title, "street": settings.marker.street, "city": settings.marker.city, "zip": settings.marker.zip },
                                ];
                                marker = constructor.createMarkers(map, searchBox, singleMarker[0], settings, false);
                                gmarkers.push(marker);
                                if (settings.map.allMarkersInViewport == true) {
                                    bounds.extend(marker.position);
                                    map.fitBounds(bounds);
                                }
                                if (settings.sidebar.visible == true && settings.sidebar.searchBox.visible == true || settings.sidebar.searchBox.search == true) {
                                    constructor.searchPlace(constructor, searchBox, map, gmarkers, element, settings);
                                }
                            } else {
                                $.ajax({
                                    url: settings.json,
                                    async: true,
                                    dataType: 'json',
                                    success: function (data) {

                                        if (clearClusterer == true) {
                                            _self._cluster.clearMarkers();
                                            clearClusterer = false;
                                        }
                                        _self._cluster = constructor.JSonMainFunction(constructor, searchBox, data, gmarkers, element, map, bounds, settings);
                                        clearClusterer = true;
                                        if (settings.preloader == true) {
                                            var $preloader = $(element).find('.ct-preloader');
                                            $preloader.addClass('make-hidden');
                                        }
                                    },
                                    error: function (jqXHR, textStatus, errorThrown) {
                                        console.log('ERROR', textStatus, errorThrown);
                                    }
                                });
                            }
                        }
                    },
                    refetchData: function (constructor, element, map, bounds, settings, clearClusterer, gmarkers) {
                        _self = this;

                        var sidebarItem = $(element).find('.ct-googleMap--sidebarItem');
                        sidebarItem.remove();
                        var selectValue = 'PKPSG1'; // selectDOM.val();
                        $(element).find('.ct-googleMap--resultsCounter').html('');
                        if (settings.preloader == true) {
                            var $preloader = $(element).find('.ct-preloader');
                            $preloader.removeClass('make-hidden');
                        }

                        var fetchTime = 0;
                        var fetchData = function () {
                            var url = settings.sidebar.selectSection.pathToJSONDirectory + selectValue;
                            $.ajax({
                                url: url,
                                dataType: 'json',
                                async: true,
                                success: function (data) {
                                    if (clearClusterer == true) {
                                        _self._cluster.clearMarkers();
                                        clearClusterer = false;
                                    }
                                    _self._data = data.data;
                                    _self._allPoints = data.data;
                                    _self._radius = data.radius;
                                    _self._cluster = constructor.JSonMainFunction(constructor, _self._searchBox, data.data, gmarkers, element, map, bounds, settings);
                                    clearClusterer = true;
                                    if (settings.preloader == true) {
                                        var $preloader = $(element).find('.ct-preloader');
                                        $preloader.addClass('make-hidden');
                                    }
                                },
                                error: function (jqXHR, textStatus, errorThrown) {
                                    //console.log('ERROR', textStatus, errorThrown);
                                    setTimeout(function () {
                                        if (fetchTime < 5) {
                                            fetchTime++;
                                            fetchData();
                                        } else {
                                            //alert(errorThrown);
                                        }
                                    }, 1000);

                                }
                            });
                        };
                        fetchData();
                    },

                    markerClick: function (map, marker, markerPosition, e, settings) {

                        this.currentMarker = marker.pickupData;
                        map.setCenter(markerPosition);
                        var contentString = "";

                        var fixedZip = marker.pickupData.zip;
                        if (!marker.pickupData.search && marker.pickupData.iid.startsWith("PKPL")) {
                            if (marker.pickupData.zip.includes('פתיחה:')) {
                                var op = marker.pickupData.zip.split('פתיחה:');
                                fixedZip = op[0] + 'פתיחה: <br />' + op[1];
                            } else if (marker.pickupData.zip.includes('פתיחה')) {
                                var op = marker.pickupData.zip.split('פתיחה');
                                fixedZip = op[0] + 'פתיחה: <br />' + op[1];
                            }

                            if (fixedZip.includes('0 ')) {
                                var sp = fixedZip.split('0 ');
                                fixedZip = sp[0] + "0 <br />" + sp[1];
                            } else if (fixedZip.includes('5 ')) {
                                var sp = fixedZip.split('5 ');
                                fixedZip = sp[0] + "5 <br />" + sp[1];
                            }
                        }

                        var point_icon;
                        var src;
                        var btn = '';
                        var misc = '';
                        if (marker.pickupData.search) {
                            point_icon = '';
                            src = server + '/api/icons/logo_small.png';
                            marker.pickupData.title = "<span id='infoBubbleSpan' style='text-align: center;'><br />" + "אתה נמצא ב:<br/><br/>" + marker.title + "</span>";
                        } else {
                            point_icon = '<img class="" alt="" src="' + server + '/api/icons/icon_18x18_' + this.getPointTypeByData(marker.pickupData) + '.png' + '" height="18" width="18">';
                            src = server + '/api/icons/' + this.getPointTypeByData(marker.pickupData) + '_logo.png';
                            btn = '<div><a onClick="window.PickupsSDK.insertSelectChoosenMarker()" class="ct-button--direction" target="_blank" style="background-color: #25408f; color: white; display: inline-block;font-weight: 500;">בחר</a></div></div></div>';
                            misc = '<span>' + marker.pickupData.street + ', ' + marker.pickupData.city + '</span><br /><br />\
                                 <div id="time_link"><div id="time_info">' + fixedZip + '</div>' + btn;
                        }

                        contentString += '<div id="infoBubbleContent" class="ct-googleMap--customInfoWindow">\
                                 <img src="' + src + '"> \
                                 <span class="infoBubble_icon">' + point_icon + '\
                                 <h4>' + marker.pickupData.title + '</h4></span>' + misc;

                        this._infoWindow.setContent(contentString);
                        this._infoWindow.open(map, marker);
                        $("#bodyContent").data("address", marker.pickupData);

                    },
                    insertSelectChoosenMarker: function (marker) {
                        if (marker)
                            this.currentMarker = marker;

                        this.settings.choose(this.currentMarker);
                    },
                    createMarkers: function (map, searchBox, markerTable, settings, isHome) {
                        var _self = this;
                        var getDirectinButton;
                        var icn;
                        if (isHome) {
                            if (this._homeMarker != null)
                                this._homeMarker.setMap(null);

                            var position = markerTable.getPlace();
                            markerTable =
                            {
                                "lat": position.geometry.location.lat(),
                                "lng": position.geometry.location.lng(),
                                "title": position.name,
                                "street": "",
                                "city": "",
                                "zip": "",
                                "search": true
                            };
                            icn = new google.maps.MarkerImage(server + '/api/icons/icon_34x44_pin_home_orange.png');
                        }
                        else {
                            icn = new google.maps.MarkerImage(server + '/api/icons/icon_32x38_pin_' + this.getPointTypeByData(markerTable) + '.png');
                        }

                        var marker = new google.maps.Marker({
                            position: new google.maps.LatLng(markerTable.lat, markerTable.lng),
                            animation: settings.marker.animation,
                            map: map,
                            title: markerTable.title,
                            icon: icn,
                            pickupData: markerTable
                        });

                        if (isHome)
                            marker.setZIndex(99999);

                        var markerPosition = marker.getPosition();
                        google.maps.event.addDomListener(marker, "click", function (e) {
                            _self.markerClick(map, marker, markerPosition, e, settings);
                        });
                        google.maps.event.addListener(_self._infoWindow, "domready", function () {
                            var child = $('.gm-style-iw').children().first();
                            child.css('overflow', 'hidden');
                            ///find next child
                            child.children().first().css('overflow', 'hidden');
                        });
                        return marker;
                    },
                    //Extend displayMarkers function, full setup of marker
                    createMarker: function (map, searchBox, markerTable, settings) {
                        var getDirectinButton;
                        var marker = new google.maps.Marker({
                            position: new google.maps.LatLng(markerTable.lat, markerTable.lng),
                            animation: settings.marker.animation,
                            map: map,
                            title: markerTable.title,
                            icon: new google.maps.MarkerImage(settings.markersIcon)
                        });
                        var markerPosition = marker.getPosition();
                        //if (settings.infoBubble.getDirectionsButton == true) {
                        //    getDirectinButton = "<a address='" + markerTable.iid + "' class='ct-button--direction make-hidden' target='_blank'>" + settings.infoBubble.getDirectionsButtonName + "</a>";
                        //    var a = $("#" + markerTable.iid);
                        //    if (a.length == 0) {
                        //        var o = $("<a class='pickUpsMarkers' />");
                        //        o.attr("id", markerTable.iid);

                        //        $("body").append(o);
                        //        o.data("address", markerTable);
                        //    }
                        //}
                        if (settings.infoBubble.visible == true) {
                            var infoBubble = new InfoBubble({
                                visible: settings.infoBubble.visible,
                                content: "<div class = 'ct-googleMap--InfoWindowBody' style='text-align: center;'>" +
                                    "<span>" + markerTable.title + "</span>" +
                                    "<span>" + markerTable.street + "</span>" +
                                    "<span style='margin-bottom: 20px;'>" + markerTable.zip + " - " + markerTable.city + "</span>" +
                                    getDirectinButton +
                                    "</div>",
                                backgroundClassName: 'ct-googleMap--customInfoWindow',
                                padding: settings.infoBubble.padding,
                                borderRadius: settings.infoBubble.borderRadius,
                                borderWidth: settings.infoBubble.borderWidth,
                                borderColor: settings.infoBubble.borderColor,
                                backgroundColor: settings.infoBubble.backgroundColor,
                                shadowStyle: settings.infoBubble.shadowStyle,
                                minHeight: settings.infoBubble.minHeight,
                                maxHeight: settings.infoBubble.maxHeight,
                                minWidth: settings.infoBubble.minWidth,
                                maxWidth: settings.infoBubble.maxWidth,
                                arrowStyle: settings.infoBubble.arrowStyle,
                                arrowSize: settings.infoBubble.arrowSize,
                                arrowPosition: settings.infoBubble.arrowPosition,
                                hideCloseButton: settings.infoBubble.hideCloseButton,
                                closeSrc: settings.infoBubble.closeSrc,
                                offsetTop: settings.infoBubble.offsetTop,
                                offsetRight: settings.infoBubble.offsetRight,
                                disableAutoPan: settings.infoBubble.disableAutoPan
                            });

                            google.maps.event.addListener(marker, "click", function () {
                                if (openInfoWindow) {
                                    openInfoWindow.close();
                                }
                                infoBubble.open(map, marker);
                                openInfoWindow = infoBubble;
                            });
                            //if (settings.infoBubble.getDirectionsButton == true) {
                            //    if (settings.infoBubble.directionsUseGeolocation == false && settings.sidebar.searchBox.visible == true && settings.sidebar.visible == true) {
                            //        var place, directionsLat, directionsLng;
                            //        var makeVis = false;
                            //        google.maps.event.addListener(searchBox, 'places_changed', function () {
                            //            place = searchBox.getPlace();
                            //            directionsLat = place.geometry.location.lat();
                            //            directionsLng = place.geometry.location.lng();
                            //            makeVis = true;
                            //        });
                            //    }

                            //    google.maps.event.addListener(infoBubble, "domready", function () {
                            //        var directionButton = $('a.ct-button--direction');
                            //        directionButton.removeClass('make-hidden');
                            //        directionButton.click(function () {
                            //            settings.choose($("#" + $(this).attr("address")).data("address"));
                            //        });
                            //    });
                            //}
                        }
                        google.maps.event.addDomListener(marker, "click", function (e) {

                            map.setCenter(markerPosition);

                        });

                        return marker;
                    },
                    insertSelectChoosenMarkerById: function (id) {
                        this.insertSelectChoosenMarker($("#" + id).data("address"));
                    },
                    //Sidebar buttons of map markers
                    createSidebarButtons: function (map, marker, element, settings, additionDesc, iid) {
                        //Creates a sidebar button
                        var _this = this;
                        var ul = $(element).find('.ct-googleMap--results');
                        var li = document.createElement("div");
                        li.id = iid;
                        li.className = "ct-googleMap--sidebarItem";
                        google.maps.event.clearListeners(li, 'click');

                        var addressList = $('.ct-googleMap--search').val().split(", ");

                        /*if (listLength < 16 || addressList.length < 3)
                        {*/

                        var point_icon = '/api/icons/icon_18x18_' + this.getPointTypeByData(marker.pickupData) + '.png';
                        li.innerHTML = (typeof (additionDesc) == 'string') ? "\
                <span class='ct-googleMap--sidebarItemTitle'>\
                    <img class='pickup-row-icon lndscp' alt='' src='" + server + point_icon + "' height='18' width='18'><span class='l-name lndscp'>" + marker.getTitle() + "</span>" + additionDesc +
                            "<div class='pickup-btn-container'>\
                        <a address='" + iid + "' class='ct-button--direction ct-button--directionex pickup-btn-choose'>בחר\
                        </a>\
                        <a class='pickup-showinmap'>\
                            <img alt='' src='" + server + "/api/icons/icon_18x18_x3_map_white.png' width='18' height='18' style='float: right'>\
                            <span style='font-size: 12px; line-height: 10px; text-align: right;'>הצג<br>במפה\
                            </span>\
                        </a>\
                    </div></span>" : "<span class='ct-googleMap--sidebarItemTitle'>" + marker.getTitle() + "</span>";
                        ul.append(li);
                        $('.ct-googleMap--sidebarItem .pickup-btn-choose').unbind('click');
                        $('.ct-googleMap--sidebarItem .pickup-btn-choose').click(function (e) {
                            e.preventDefault();
                            window.PickupsSDK.insertSelectChoosenMarkerById($(this).attr("address"));
                        });
                        //}
                        //Trigger a click event to marker when the button is clicked.
                        google.maps.event.addDomListener(li, "click", function () {

                            this.currentMarker = $(li).data("address");

                            google.maps.event.trigger(marker, "click");

                            _this._mapCanvas.setZoom(14);
                            _this._mapCanvas.setCenter(marker.getPosition());

                        });

                        return li;
                    },
                    createSidebarItems: function (map, markers, element, settings) {
                        //console.time('createSidebarItems');

                        var showDistance = (this._defaults || (this._searchBox && this._searchBox.getPlace().name != ''));
                        //var distWithUnit = "";

                        //distWithUnit = (dataMarkers[i].dist != null && (this._defaults || (this._searchBox && this._searchBox.getPlace().name != ''))) ? " (" + dataMarkers[i].dist + ' ק"מ' + ")." : "";

                        //var li = constructor.createSidebarButtons(_self._mfapCanvas, marker, element, settings, "<small>" + dataMarkers[i].street + ", " + dataMarkers[i].city + distWithUnit + "</small>", dataMarkers[i].iid);
                        //$(li).data("address", dataMarkers[i]);                        

                        //Creates a sidebar button
                        var _this = this;
                        var ul = $(element).find('.ct-googleMap--results');
                        for (var i = 0; i < markers.length; i++) {
                            var marker = markers[i];
                            var additionDesc = "<small><label></label>" + marker.pickupData.street + ", " + marker.pickupData.city + "</small>";
                            if (showDistance && marker.pickupData.dist != null) {
                                additionDesc += " (" + marker.pickupData.dist + ' ק"מ' + ").";
                            }
                            var li = document.createElement("div");
                            li.id = marker.pickupData.iid;
                            li.className = "ct-googleMap--sidebarItem";
                            google.maps.event.clearListeners(li, 'click');

                            var point_icon = '/api/icons/icon_18x18_' + this.getPointTypeByData(marker.pickupData) + '.png';
                            li.innerHTML = (typeof (additionDesc) == 'string') ? "\
                <span class='ct-googleMap--sidebarItemTitle'>\
                    <img class='pickup-row-icon lndscp' alt='' src='" + server + point_icon + "' height='18' width='18'><span class='l-name lndscp'>" + marker.getTitle() + additionDesc + "</span>" +
                                "<div class='pickup-btn-container'>\
                        <a address='" + marker.pickupData.iid + "' class='ct-button--direction ct-button--directionex pickup-btn-choose'>בחר\
                        </a>\
                        <a class='pickup-showinmap'>\
                            <img alt='' src='" + server + "/api/icons/icon_18x18_x3_map_white.png' width='18' height='18' style='float: right'>\
                            <span style='font-size: 12px; line-height: 10px; text-align: right;'>הצג<br>במפה\
                            </span>\
                        </a>\
                    </div></span>" : "<span class='ct-googleMap--sidebarItemTitle'>" + marker.getTitle() + "</span>";
                            ul.append(li);

                            //Trigger a click event to marker when the button is clicked.
                            google.maps.event.addDomListener(li, "click", function () {

                                _this.currentMarker = $(this).data("address");
                                var marker = _this._markers.find(function (e) {
                                    return e.pickupData.iid === _this.currentMarker.iid;
                                });
                                google.maps.event.trigger(marker, "click");

                                _this._mapCanvas.setZoom(14);
                                _this._mapCanvas.setCenter(marker.getPosition());

                            });

                            $(li).data("address", marker.pickupData);
                        }
                        $('.ct-googleMap--sidebarItem .pickup-btn-choose').unbind('click');
                        $('.ct-googleMap--sidebarItem .pickup-btn-choose').click(function (e) {
                            e.preventDefault();
                            window.PickupsSDK.insertSelectChoosenMarkerById($(this).attr("address"));
                        });
                        //console.timeEnd('createSidebarItems');
                    },
                    //Google map search function.
                    searchPlace: function (constructor, searchBox, map, markerTable, element, settings) {
                        var locations = [];

                        var marker;
                        // Listen for the event fired when the user selects an item from the
                        // pick list. Retrieve the matching places for that item.

                        google.maps.event.addListener(searchBox, 'place_changed', function (e) {

                            sidebarItem = $(element).find('.ct-googleMap--sidebarItem');
                            sidebarItem.remove();

                            var place = searchBox.getPlace();
                            var searchLocationPosition = new google.maps.LatLng(place.geometry.location.lat(), place.geometry.location.lng());
                            if (settings.sidebar.searchBox.search == true) {

                                var r = $(this.element).find('.ct-googleMap--results');
                                r.addClass("ct-googleMap--results-loader");
                                var options = {
                                    lat: searchLocationPosition.lat(),
                                    lng: searchLocationPosition.lng()
                                };
                                if (this._service == 'drops') {
                                    options.types = '4';
                                }
                                $.post(server + "/Home/PostFreeText",
                                    options,
                                    function (data, status) {


                                        var result = JSON.parse(data);
                                        for (var i = 0; i < result.Points.length; i++) {
                                            //this.displaySearchResults()
                                            var ul = $(element).find('.ct-googleMap--results');
                                            var li = document.createElement("div");
                                            markerTable.title = result.Points[i].LocationDescription;
                                            li.className = "ct-googleMap--sidebarItem";
                                            google.maps.event.clearListeners(li, 'click');

                                            li.innerHTML = "<span class='ct-googleMap--sidebarItemTitle'>" + result.Points[i].CityName + " " + result.Points[i].LocationDescription + "</span>";
                                            ul.append(li);
                                        }
                                        r.removeClass("ct-googleMap--results-loader");
                                    }

                                )
                            }

                            map.setCenter(place.geometry.location);

                            if (place.length == 0)
                                return;

                            var lat = place.geometry.location.lat();
                            var lng = place.geometry.location.lng();

                            map.setZoom(14);
                        });
                    },
                    //This function makes all pages of results with pagination, extends displaySearchResults function.
                    resultsInPage: function (constructor, element, settings) {
                        var pageSize = settings.sidebar.results.pageSize;
                        var currentPage = settings.sidebar.results.currentPage;
                        var pageCounter = 1;
                        var sidebarResults = $(element).find('.ct-googleMap--results');
                        var pageNav = "<ul class='Navigation'>";
                        var pageNavPages = "<li class='paginationCounter' style='overflow: hidden; height: 32px; padding-top: 5px; direction: ltr'>";

                        constructor.sidebarClear(pageCounter, element);

                        if (settings.paginationStyle != 1) {
                            pageNavPages += "</li>";
                        } else {
                            pageNavPages += "<a rel='1' class='NavPage' style='display: inline-block; width: 26px; height: 26px; font-size: 17px; padding: 0 0'>" + 1 + "</a>";
                        }

                        sidebarResults.children().each(function (i) {
                            var className = 'ct-googleMap--sidebarItem ';
                            if (i < pageCounter * pageSize && i >= (pageCounter - 1) * pageSize) {
                                className += "page" + pageCounter;
                            }
                            else {
                                className += "page" + (pageCounter + 1);
                                if (settings.paginationStyle == 1) {
                                    pageNavPages += "<a rel='" + (pageCounter + 1) + "' class='NavPage' style='display: inline-block; width: 26px; height: 26px; font-size: 17px; padding: 0 0'>" + (pageCounter + 1) + "</a>";
                                    //pageNavPages += "";
                                }
                                pageCounter++;
                            }
                            $(this).attr("class", className);
                        });
                        if (settings.paginationStyle == 1) {
                            pageNavPages += "</li>";
                        }

                        // show/hide the appropriate regions
                        sidebarResults.children().hide();
                        sidebarResults.children(".page" + currentPage).show();

                        if (pageCounter <= 1) {
                            return;
                        }

                        //Build pager navigation

                        var i = 1;

                        pageNav += "<li class='NavigationPrev NavigationDisable Navigation" + (i + 1) + "'><a rel='" + (i + 1) + "'>" + "</a></li>";
                        pageNav += pageNavPages;
                        pageNav += "<li class='NavigationNext Navigation" + i + "'><a rel='" + i + "' >" + "</a></li>";
                        pageNav += "</ul>";

                        $('#pickups_body').find('.ct-googleMap--sidebar').append(pageNav);

                        constructor.pagination(constructor, sidebarResults, pageCounter, pageSize, currentPage, element, settings);
                    },
                    //Create pagination, extends resultsInPage function
                    pagination: function (constructor, sidebarResults, pageCounter, pageSize, currentPage, element, settings) {

                        var context = this;
                        var i = 1;
                        var k = 1;
                        var goToPage;
                        var paginationCounter = 1;
                        var paginationCounterElement = $(element).find('.paginationCounter');
                        var NavigationPrev = $(element).find('.NavigationPrev');
                        var NavigationNext = $(element).find('.NavigationNext');

                        if (settings.paginationStyle == 2) {
                            constructor.counterElements(sidebarResults, paginationCounterElement, pageCounter, pageSize, currentPage, element);
                        }

                        if (settings.paginationStyle == 1) {
                            paginationCounterElement.children().each(function (i) {
                                if (i < paginationCounter * settings.sidebar.results.paginationItems && i >= (paginationCounter - 1) * settings.sidebar.results.paginationItems) {
                                    $(this).addClass("paginationPage" + paginationCounter);
                                } else {
                                    $(this).addClass("paginationPage" + (paginationCounter + 1));
                                    paginationCounter = paginationCounter + 1;
                                }
                            });
                            paginationCounterElement.children().hide();
                            paginationCounterElement.children(".paginationPage" + currentPage).show();
                            $(element).find(".NavPage[rel='" + currentPage + "']").addClass('active');

                            $(element).find('.NavPage').on("click", function () {
                                var whatPage = $(this).attr('rel');
                                $(this).addClass('active').siblings().removeClass('active');
                                goToPage = true;
                                if (whatPage < i) {
                                    i = whatPage;
                                    NavigationPrev.trigger("click");
                                } else {
                                    i = whatPage;
                                    NavigationNext.trigger("click");
                                }
                            });
                        }

                        $(element).find('.NavigationPrev').on("click", function () {

                            if (goToPage == true) {
                                sidebarResults.children().hide();
                                sidebarResults.find(".page" + i).show();
                                if (i == 1) {
                                    $(this).addClass('NavigationDisable');
                                }
                                NavigationNext.removeClass('NavigationDisable');
                                goToPage = false
                            } else {
                                if (i == 1) {
                                    i = 1;
                                    sidebarResults.children().hide();
                                    sidebarResults.find(".page" + i).show();
                                } else {
                                    if (i == 2) {
                                        $(this).addClass('NavigationDisable');
                                    }
                                    NavigationNext.removeClass('NavigationDisable');
                                    i = i - 1;
                                    sidebarResults.children().hide();
                                    sidebarResults.find(".page" + i).show();
                                }
                                if (settings.paginationStyle != 1) {
                                    paginationCounterElement.children().hide();
                                    paginationCounterElement.children(".paginationCount" + i).show();
                                } else {
                                    if (i < k * settings.sidebar.results.paginationItems && i == (k - 1) * settings.sidebar.results.paginationItems) {
                                        k = k - 1;
                                        paginationCounterElement.children().hide();
                                        paginationCounterElement.children(".paginationPage" + k).show();
                                    } else {
                                        if (i < k * settings.sidebar.results.paginationItems && i >= (k - 1) * settings.sidebar.results.paginationItems) {
                                            paginationCounterElement.children().hide();
                                            paginationCounterElement.children(".paginationPage" + k).show();
                                        } else {
                                            k = k - 1;
                                            paginationCounterElement.children().hide();
                                            paginationCounterElement.children(".paginationPage" + k).show();
                                        }
                                    }
                                    $(element).find(".NavPage[rel='" + i + "']").addClass('active').siblings().removeClass('active');
                                }
                            }
                            //context.updateDistance(false);
                        });
                        $(element).find('.NavigationNext').on("click", function () {

                            ($('.page' + i).each(function () { $(this).addClass("sideBarVisible"); }));

                            if (goToPage == true) {
                                sidebarResults.children().hide();
                                sidebarResults.find(".page" + i).show();
                                if (i == pageCounter) {
                                    $(this).addClass('NavigationDisable');
                                }
                                NavigationPrev.removeClass('NavigationDisable');
                                goToPage = false
                            } else {
                                if (i == pageCounter) {
                                    i = pageCounter;
                                    sidebarResults.children().hide();
                                    sidebarResults.find(".page" + i).show();
                                }
                                else {
                                    if (i == pageCounter - 1) {
                                        $(this).addClass('NavigationDisable');
                                    }
                                    NavigationPrev.removeClass('NavigationDisable');
                                    i = parseInt((i), 10) + 1;
                                    sidebarResults.children().hide();
                                    sidebarResults.find(".page" + i).show();
                                }
                                if (settings.paginationStyle != 1) {
                                    paginationCounterElement.children().hide();
                                    paginationCounterElement.children(".paginationCount" + i).show();
                                } else {
                                    if (i < k * settings.sidebar.results.paginationItems && i >= (k - 1) * settings.sidebar.results.paginationItems || i == k * settings.sidebar.results.paginationItems) {
                                        paginationCounterElement.children().hide();
                                        paginationCounterElement.children(".paginationPage" + k).show();
                                    } else {
                                        k++;
                                        paginationCounterElement.children().hide();
                                        paginationCounterElement.children(".paginationPage" + k).show();
                                    }
                                    $(element).find(".NavPage[rel='" + i + "']").addClass('active').siblings().removeClass('active');
                                }
                            }
                            //context.updateDistance(false);
                        });


                    },
                    //Count how much items is found, extends pagination function
                    counterElements: function (sidebarResults, paginationCounterElement, pageCounter, pageSize, currentPage, element) {
                        var tableResults = [];

                        for (var j = 0; pageCounter > j; j++) {
                            tableResults.push($(element).find('.page' + (1 + j)).length);
                            if (tableResults[j] > 1) {
                                paginationCounterElement.append("<span class='paginationCount" + (j + 1) + "'>" + (1 + j * pageSize) + " - " + (tableResults[j] + j * pageSize) + " of " + sidebarResults.children().length + "</span>");
                            }
                            else {
                                paginationCounterElement.append("<span class='paginationCount" + (j + 1) + "'>" + (tableResults[j] + j * pageSize) + " of " + sidebarResults.children().length + "</span>");
                            }
                        }
                        paginationCounterElement.children().hide();
                        $(element).find(".paginationCount" + currentPage).show();
                    },
                    //Create select with multiple json files
                    createSelectSection: function (element, settings) {

                        var difFiles = settings.sidebar.selectSection.difFiles;
                        var sidebarSelect = $(element).find('.ct-googleMap--select');
                        for (var k = 0; difFiles.length > k; k++) {
                            var outP = "<option value='" + difFiles[k][1] + "'>" + difFiles[k][0] + "</option>";
                            sidebarSelect.append(outP);
                        }
                    },
                    sidebarClear: function (pageCounter, element) {
                        $(element).find('.Navigation').remove();
                        pageCounter = 1;
                    }
                });

                // A really lightweight plugin wrapper around the constructor,
                // preventing against multiple instantiations
                $.fn[pluginName] = function (options) {
                    return this.each(function () {
                        if (!$.data(this, "plugin_" + pluginName)) {
                            var plugin = new Plugin(this, options);
                            $.data(this, "plugin_" + pluginName, plugin);
                            this.addon = function () {
                                return plugin;
                            }
                        }
                    });
                };

                $(
                    function () {
                        window.PickupsSDK = new Plugin(this,
                            {
                                "pluginStyle": "cosmic",
                                "paginationStyle": 1,
                                "infoBubble":
                                {
                                    "visible": true,
                                    "arrowPosition": 50,
                                    "minHeight": 112,
                                    "maxHeight": null,
                                    "minWidth": 170,
                                    "maxWidth": 250
                                },
                                "markersIcon": server + "/Content/assets/plugins/shoplocator/cosmic/images/marker.png",
                                "map":
                                {
                                    "zoom": 10,
                                    "allMarkersInViewport": true,
                                    "center": [31.9887374, 34.9010247]
                                },
                                "cluster":
                                {
                                    "enable": true,
                                    "gridSize": 50,
                                    "style":
                                    {
                                        "textColor": "#4757a3",
                                        "textSize": 18,
                                        "heightSM": 42,
                                        "widthSM": 42,
                                        "heightMD": 56,
                                        "widthMD": 56,
                                        "heightBIG": 75,
                                        "widthBIG": 75,
                                        "iconSmall": server + "/Content/assets/plugins/shoplocator/cosmic/images/clusterSmall.png",
                                        "iconMedium": server + "/Content/assets/plugins/shoplocator/cosmic/images/clusterMedium.png",
                                        "iconBig": server + "/Content/assets/plugins/shoplocator/cosmic/images/clusterBig.png"
                                    }
                                },
                                "sidebar":
                                {
                                    "visible": true,
                                    "selectSection":
                                    {
                                        "visible": true,
                                        "difFiles": []
                                    },
                                    "searchBox":
                                    {
                                        "visible": true,
                                        "search": false,
                                        "searchByCountry": [false, "il"],
                                        "placeHolder": "נא הזן כתובת"
                                    },
                                    "results": { "pageSize": 8 }
                                }
                            });
                        setTimeout(function () { window.PickupsSDK.init(service); }, 100);
                    }
                );
            }
        })(window, document);
        if (!String.prototype.startsWith) {
            String.prototype.startsWith = function (searchString, position) {
                position = position || 0;
                return this.indexOf(searchString, position) === position;
            };
        }
        if (!Array.prototype.find) {
            Object.defineProperty(Array.prototype, 'find', {
                value: function (predicate) {
                    // 1. Let O be ? ToObject(this value).
                    if (this == null) {
                        throw new TypeError('"this" is null or not defined');
                    }

                    var o = Object(this);

                    // 2. Let len be ? ToLength(? Get(O, "length")).
                    var len = o.length >>> 0;

                    // 3. If IsCallable(predicate) is false, throw a TypeError exception.
                    if (typeof predicate !== 'function') {
                        throw new TypeError('predicate must be a function');
                    }

                    // 4. If thisArg was supplied, let T be thisArg; else let T be undefined.
                    var thisArg = arguments[1];

                    // 5. Let k be 0.
                    var k = 0;

                    // 6. Repeat, while k < len
                    while (k < len) {
                        // a. Let Pk be ! ToString(k).
                        // b. Let kValue be ? Get(O, Pk).
                        // c. Let testResult be ToBoolean(? Call(predicate, T, « kValue, k, O »)).
                        // d. If testResult is true, return kValue.
                        var kValue = o[k];
                        if (predicate.call(thisArg, kValue, k, o)) {
                            return kValue;
                        }
                        // e. Increase k by 1.
                        k++;
                    }

                    // 7. Return undefined.
                    return undefined;
                }
            });
        }
    </script>
    <script>
        function InfoBubble(t) { this.extend(InfoBubble, google.maps.OverlayView), this.tabs_ = [], this.activeTab_ = null, this.baseZIndex_ = 100, this.isOpen_ = !1; var e = t || {}; void 0 == e.backgroundColor && (e.backgroundColor = this.BACKGROUND_COLOR_), void 0 == e.borderColor && (e.borderColor = this.BORDER_COLOR_), void 0 == e.borderRadius && (e.borderRadius = this.BORDER_RADIUS_), void 0 == e.borderWidth && (e.borderWidth = this.BORDER_WIDTH_), void 0 == e.padding && (e.padding = this.PADDING_), void 0 == e.arrowPosition && (e.arrowPosition = this.ARROW_POSITION_), void 0 == e.disableAutoPan && (e.disableAutoPan = !1), void 0 == e.disableAnimation && (e.disableAnimation = !1), void 0 == e.minWidth && (e.minWidth = this.MIN_WIDTH_), void 0 == e.shadowStyle && (e.shadowStyle = this.SHADOW_STYLE_), void 0 == e.arrowSize && (e.arrowSize = this.ARROW_SIZE_), void 0 == e.arrowStyle && (e.arrowStyle = this.ARROW_STYLE_), void 0 == e.closeSrc && (e.closeSrc = this.CLOSE_SRC_), void 0 == e.offsetTop && (e.offsetTop = this.OFFSET_TOP_), void 0 == e.offsetRight && (e.offsetRight = this.OFFSET_RIGHT_), this.buildDom_(), this.setValues(e) } window.InfoBubble = InfoBubble, InfoBubble.prototype.ARROW_SIZE_ = 15, InfoBubble.prototype.ARROW_STYLE_ = 0, InfoBubble.prototype.SHADOW_STYLE_ = 1, InfoBubble.prototype.MIN_WIDTH_ = 50, InfoBubble.prototype.ARROW_POSITION_ = 50, InfoBubble.prototype.PADDING_ = 10, InfoBubble.prototype.BORDER_WIDTH_ = 1, InfoBubble.prototype.BORDER_COLOR_ = "#ccc", InfoBubble.prototype.BORDER_RADIUS_ = 10, InfoBubble.prototype.BACKGROUND_COLOR_ = "#fff", InfoBubble.prototype.CLOSE_SRC_ = "https://maps.gstatic.com/intl/en_us/mapfiles/iw_close.gif", InfoBubble.prototype.OFFSET_TOP_ = 2, InfoBubble.prototype.OFFSET_RIGHT_ = 2, InfoBubble.prototype.extend = function (t, e) { return function (t) { for (var e in t.prototype) this.prototype[e] = t.prototype[e]; return this }.apply(t, [e]) }, InfoBubble.prototype.buildDom_ = function () { var t = this.bubble_ = document.createElement("DIV"); t.style.position = "absolute", t.style.zIndex = this.baseZIndex_; var e = this.tabsContainer_ = document.createElement("DIV"); e.style.position = "relative"; var o = this.close_ = document.createElement("IMG"); o.style.position = "absolute", o.style.border = 0, o.style.zIndex = this.baseZIndex_ + 1, o.style.cursor = "pointer"; var i = this; google.maps.event.addDomListener(o, "click", function () { i.close(), google.maps.event.trigger(i, "closeclick") }); var n = this.contentContainer_ = document.createElement("DIV"); n.style.overflowX = "visible", n.style.overflowY = "visible", n.style.cursor = "default", n.style.clear = "both", n.style.position = "relative"; var s = this.content_ = document.createElement("DIV"); n.appendChild(s); var r = this.arrow_ = document.createElement("DIV"); r.style.position = "relative"; var a = this.arrowOuter_ = document.createElement("DIV"), b = this.arrowInner_ = document.createElement("DIV"), h = this.getArrowSize_(); a.style.position = b.style.position = "absolute", a.style.left = b.style.left = "50%", a.style.height = b.style.height = "0", a.style.width = b.style.width = "0", a.style.marginLeft = this.px(-h), a.style.borderWidth = this.px(h), a.style.borderBottomWidth = 0; var l = this.bubbleShadow_ = document.createElement("DIV"); l.style.position = "absolute", t.style.display = l.style.display = "none", t.appendChild(this.tabsContainer_), t.appendChild(o), t.appendChild(n), r.appendChild(a), r.appendChild(b), t.appendChild(r); var p = document.createElement("style"); p.setAttribute("type", "text/css"), this.animationName_ = "_ibani_" + Math.round(1e4 * Math.random()); var d = "." + this.animationName_ + "{-webkit-animation-name:" + this.animationName_ + ";-webkit-animation-duration:0.5s;-webkit-animation-iteration-count:1;}@-webkit-keyframes " + this.animationName_ + " {from {-webkit-transform: scale(0)}50% {-webkit-transform: scale(1.2)}90% {-webkit-transform: scale(0.95)}to {-webkit-transform: scale(1)}}"; p.textContent = d, document.getElementsByTagName("head")[0].appendChild(p) }, InfoBubble.prototype.setBackgroundClassName = function (t) { this.set("backgroundClassName", t) }, InfoBubble.prototype.setBackgroundClassName = InfoBubble.prototype.setBackgroundClassName, InfoBubble.prototype.backgroundClassName_changed = function () { this.content_.className = this.get("backgroundClassName") }, InfoBubble.prototype.backgroundClassName_changed = InfoBubble.prototype.backgroundClassName_changed, InfoBubble.prototype.setTabClassName = function (t) { this.set("tabClassName", t) }, InfoBubble.prototype.setTabClassName = InfoBubble.prototype.setTabClassName, InfoBubble.prototype.tabClassName_changed = function () { this.updateTabStyles_() }, InfoBubble.prototype.tabClassName_changed = InfoBubble.prototype.tabClassName_changed, InfoBubble.prototype.getArrowStyle_ = function () { return parseInt(this.get("arrowStyle"), 10) || 0 }, InfoBubble.prototype.setArrowStyle = function (t) { this.set("arrowStyle", t) }, InfoBubble.prototype.setArrowStyle = InfoBubble.prototype.setArrowStyle, InfoBubble.prototype.arrowStyle_changed = function () { this.arrowSize_changed() }, InfoBubble.prototype.arrowStyle_changed = InfoBubble.prototype.arrowStyle_changed, InfoBubble.prototype.getArrowSize_ = function () { return parseInt(this.get("arrowSize"), 10) || 0 }, InfoBubble.prototype.setArrowSize = function (t) { this.set("arrowSize", t) }, InfoBubble.prototype.setArrowSize = InfoBubble.prototype.setArrowSize, InfoBubble.prototype.arrowSize_changed = function () { this.borderWidth_changed() }, InfoBubble.prototype.arrowSize_changed = InfoBubble.prototype.arrowSize_changed, InfoBubble.prototype.setArrowPosition = function (t) { this.set("arrowPosition", t) }, InfoBubble.prototype.setArrowPosition = InfoBubble.prototype.setArrowPosition, InfoBubble.prototype.getArrowPosition_ = function () { return parseInt(this.get("arrowPosition"), 10) || 0 }, InfoBubble.prototype.arrowPosition_changed = function () { var t = this.getArrowPosition_(); this.arrowOuter_.style.left = this.arrowInner_.style.left = t + "%", this.redraw_() }, InfoBubble.prototype.arrowPosition_changed = InfoBubble.prototype.arrowPosition_changed, InfoBubble.prototype.setZIndex = function (t) { this.set("zIndex", t) }, InfoBubble.prototype.setZIndex = InfoBubble.prototype.setZIndex, InfoBubble.prototype.getZIndex = function () { return parseInt(this.get("zIndex"), 10) || this.baseZIndex_ }, InfoBubble.prototype.zIndex_changed = function () { var t = this.getZIndex(); this.bubble_.style.zIndex = this.baseZIndex_ = t, this.close_.style.zIndex = t + 1 }, InfoBubble.prototype.zIndex_changed = InfoBubble.prototype.zIndex_changed, InfoBubble.prototype.setShadowStyle = function (t) { this.set("shadowStyle", t) }, InfoBubble.prototype.setShadowStyle = InfoBubble.prototype.setShadowStyle, InfoBubble.prototype.getShadowStyle_ = function () { return parseInt(this.get("shadowStyle"), 10) || 0 }, InfoBubble.prototype.shadowStyle_changed = function () { var t = this.getShadowStyle_(), e = "", o = "", i = ""; switch (t) { case 0: e = "none"; break; case 1: o = "40px 15px 10px rgba(33,33,33,0.3)", i = "transparent"; break; case 2: o = "0 0 2px rgba(33,33,33,0.3)", i = "rgba(33,33,33,0.35)" } this.bubbleShadow_.style.boxShadow = this.bubbleShadow_.style.webkitBoxShadow = this.bubbleShadow_.style.MozBoxShadow = o, this.bubbleShadow_.style.backgroundColor = i, this.isOpen_ && (this.bubbleShadow_.style.display = e, this.draw()) }, InfoBubble.prototype.shadowStyle_changed = InfoBubble.prototype.shadowStyle_changed, InfoBubble.prototype.showCloseButton = function () { this.set("hideCloseButton", !1) }, InfoBubble.prototype.showCloseButton = InfoBubble.prototype.showCloseButton, InfoBubble.prototype.hideCloseButton = function () { this.set("hideCloseButton", !0) }, InfoBubble.prototype.hideCloseButton = InfoBubble.prototype.hideCloseButton, InfoBubble.prototype.hideCloseButton_changed = function () { this.close_.style.display = this.get("hideCloseButton") ? "none" : "" }, InfoBubble.prototype.hideCloseButton_changed = InfoBubble.prototype.hideCloseButton_changed, InfoBubble.prototype.setBackgroundColor = function (t) { t && this.set("backgroundColor", t) }, InfoBubble.prototype.setBackgroundColor = InfoBubble.prototype.setBackgroundColor, InfoBubble.prototype.backgroundColor_changed = function () { var t = this.get("backgroundColor"); this.contentContainer_.style.backgroundColor = t, this.arrowInner_.style.borderColor = t + " transparent transparent", this.updateTabStyles_() }, InfoBubble.prototype.backgroundColor_changed = InfoBubble.prototype.backgroundColor_changed, InfoBubble.prototype.setBorderColor = function (t) { t && this.set("borderColor", t) }, InfoBubble.prototype.setBorderColor = InfoBubble.prototype.setBorderColor, InfoBubble.prototype.borderColor_changed = function () { var t = this.get("borderColor"), e = this.contentContainer_, o = this.arrowOuter_; e.style.borderColor = t, o.style.borderColor = t + " transparent transparent", e.style.borderStyle = o.style.borderStyle = this.arrowInner_.style.borderStyle = "solid", this.updateTabStyles_() }, InfoBubble.prototype.borderColor_changed = InfoBubble.prototype.borderColor_changed, InfoBubble.prototype.setBorderRadius = function (t) { this.set("borderRadius", t) }, InfoBubble.prototype.setBorderRadius = InfoBubble.prototype.setBorderRadius, InfoBubble.prototype.getBorderRadius_ = function () { return parseInt(this.get("borderRadius"), 10) || 0 }, InfoBubble.prototype.borderRadius_changed = function () { var t = this.getBorderRadius_(), e = this.getBorderWidth_(); this.contentContainer_.style.borderRadius = this.contentContainer_.style.MozBorderRadius = this.contentContainer_.style.webkitBorderRadius = this.bubbleShadow_.style.borderRadius = this.bubbleShadow_.style.MozBorderRadius = this.bubbleShadow_.style.webkitBorderRadius = this.px(t), this.tabsContainer_.style.paddingLeft = this.tabsContainer_.style.paddingRight = this.px(t + e), this.redraw_() }, InfoBubble.prototype.borderRadius_changed = InfoBubble.prototype.borderRadius_changed, InfoBubble.prototype.getBorderWidth_ = function () { return parseInt(this.get("borderWidth"), 10) || 0 }, InfoBubble.prototype.setBorderWidth = function (t) { this.set("borderWidth", t) }, InfoBubble.prototype.setBorderWidth = InfoBubble.prototype.setBorderWidth, InfoBubble.prototype.borderWidth_changed = function () { var t = this.getBorderWidth_(); this.contentContainer_.style.borderWidth = this.px(t), this.tabsContainer_.style.top = this.px(t), this.updateArrowStyle_(), this.updateTabStyles_(), this.borderRadius_changed(), this.redraw_() }, InfoBubble.prototype.borderWidth_changed = InfoBubble.prototype.borderWidth_changed, InfoBubble.prototype.updateArrowStyle_ = function () { var t = this.getBorderWidth_(), e = this.getArrowSize_(), o = this.getArrowStyle_(), i = this.px(e), n = this.px(Math.max(0, e - t)), s = this.arrowOuter_, r = this.arrowInner_; this.arrow_.style.marginTop = this.px(-t), s.style.borderTopWidth = i, r.style.borderTopWidth = n, 0 == o || 1 == o ? (s.style.borderLeftWidth = i, r.style.borderLeftWidth = n) : s.style.borderLeftWidth = r.style.borderLeftWidth = 0, 0 == o || 2 == o ? (s.style.borderRightWidth = i, r.style.borderRightWidth = n) : s.style.borderRightWidth = r.style.borderRightWidth = 0, 2 > o ? (s.style.marginLeft = this.px(-e), r.style.marginLeft = this.px(-(e - t))) : s.style.marginLeft = r.style.marginLeft = 0, s.style.display = 0 == t ? "none" : "" }, InfoBubble.prototype.setPadding = function (t) { this.set("padding", t) }, InfoBubble.prototype.setPadding = InfoBubble.prototype.setPadding, InfoBubble.prototype.setCloseSrc = function (t) { t && this.close_ && (this.close_.src = t) }, InfoBubble.prototype.setCloseSrc = InfoBubble.prototype.setCloseSrc, InfoBubble.prototype.getPadding_ = function () { return parseInt(this.get("padding"), 10) || 0 }, InfoBubble.prototype.padding_changed = function () { var t = this.getPadding_(); this.contentContainer_.style.padding = this.px(t), this.updateTabStyles_(), this.redraw_() }, InfoBubble.prototype.padding_changed = InfoBubble.prototype.padding_changed, InfoBubble.prototype.px = function (t) { return t ? t + "px" : t }, InfoBubble.prototype.addEvents_ = function () { var t = ["mousedown", "mousemove", "mouseover", "mouseout", "mouseup", "mousewheel", "DOMMouseScroll", "touchstart", "touchend", "touchmove", "dblclick", "contextmenu", "click"], e = this.bubble_; this.listeners_ = []; for (var o, i = 0; o = t[i]; i++) this.listeners_.push(google.maps.event.addDomListener(e, o, function (t) { t.cancelBubble = !0, t.stopPropagation && t.stopPropagation() })) }, InfoBubble.prototype.onAdd = function () { this.bubble_ || this.buildDom_(), this.addEvents_(); var t = this.getPanes(); t && (t.floatPane.appendChild(this.bubble_), t.floatShadow.appendChild(this.bubbleShadow_)), google.maps.event.trigger(this, "domready") }, InfoBubble.prototype.onAdd = InfoBubble.prototype.onAdd, InfoBubble.prototype.draw = function () { var t = this.getProjection(); if (t) { var e = this.get("position"); if (!e) return void this.close(); var o = 0; this.activeTab_ && (o = this.activeTab_.offsetHeight); var i = this.getAnchorHeight_(), n = this.getArrowSize_(), s = this.getArrowPosition_(); s /= 100; var r = t.fromLatLngToDivPixel(e), a = this.contentContainer_.offsetWidth, b = this.bubble_.offsetHeight; if (a) { var h = r.y - (b + n); i && (h -= i); var l = r.x - a * s; this.bubble_.style.top = this.px(h), this.bubble_.style.left = this.px(l); var p = parseInt(this.get("shadowStyle"), 10); switch (p) { case 1: this.bubbleShadow_.style.top = this.px(h + o - 1), this.bubbleShadow_.style.left = this.px(l), this.bubbleShadow_.style.width = this.px(a), this.bubbleShadow_.style.height = this.px(this.contentContainer_.offsetHeight - n); break; case 2: a = .8 * a, this.bubbleShadow_.style.top = this.px(i ? r.y : r.y + n), this.bubbleShadow_.style.left = this.px(r.x - a * s), this.bubbleShadow_.style.width = this.px(a), this.bubbleShadow_.style.height = this.px(2) } } } }, InfoBubble.prototype.draw = InfoBubble.prototype.draw, InfoBubble.prototype.onRemove = function () { this.bubble_ && this.bubble_.parentNode && this.bubble_.parentNode.removeChild(this.bubble_), this.bubbleShadow_ && this.bubbleShadow_.parentNode && this.bubbleShadow_.parentNode.removeChild(this.bubbleShadow_); for (var t, e = 0; t = this.listeners_[e]; e++) google.maps.event.removeListener(t) }, InfoBubble.prototype.onRemove = InfoBubble.prototype.onRemove, InfoBubble.prototype.isOpen = function () { return this.isOpen_ }, InfoBubble.prototype.isOpen = InfoBubble.prototype.isOpen, InfoBubble.prototype.close = function () { this.bubble_ && (this.bubble_.style.display = "none", this.bubble_.className = this.bubble_.className.replace(this.animationName_, "")), this.bubbleShadow_ && (this.bubbleShadow_.style.display = "none", this.bubbleShadow_.className = this.bubbleShadow_.className.replace(this.animationName_, "")), this.isOpen_ = !1 }, InfoBubble.prototype.close = InfoBubble.prototype.close, InfoBubble.prototype.open = function (t, e) { var o = this; window.setTimeout(function () { o.open_(t, e) }, 0) }, InfoBubble.prototype.open_ = function (t, e) { this.updateContent_(), t && this.setMap(t), e && (this.set("anchor", e), this.bindTo("anchorPoint", e), this.bindTo("position", e)), this.bubble_.style.display = this.bubbleShadow_.style.display = ""; var o = !this.get("disableAnimation"); o && (this.bubble_.className += " " + this.animationName_, this.bubbleShadow_.className += " " + this.animationName_), this.redraw_(), this.isOpen_ = !0; var i = !this.get("disableAutoPan"); if (i) { var n = this; window.setTimeout(function () { n.panToView() }, 200) } }, InfoBubble.prototype.open = InfoBubble.prototype.open, InfoBubble.prototype.setPosition = function (t) { t && this.set("position", t) }, InfoBubble.prototype.setPosition = InfoBubble.prototype.setPosition, InfoBubble.prototype.getPosition = function () { return this.get("position") }, InfoBubble.prototype.getPosition = InfoBubble.prototype.getPosition, InfoBubble.prototype.position_changed = function () { this.draw() }, InfoBubble.prototype.position_changed = InfoBubble.prototype.position_changed, InfoBubble.prototype.panToView = function () { var t = this.getProjection(); if (t && this.bubble_) { var e = this.getAnchorHeight_(), o = this.bubble_.offsetHeight + e, i = this.get("map"), n = i.getDiv(), s = n.offsetHeight, r = this.getPosition(), a = t.fromLatLngToContainerPixel(i.getCenter()), b = t.fromLatLngToContainerPixel(r), h = a.y - o, l = s - a.y, p = 0 > h, d = 0; p && (h *= -1, d = (h + l) / 2), b.y -= d, r = t.fromContainerPixelToLatLng(b), i.getCenter() != r && i.panTo(r) } }, InfoBubble.prototype.panToView = InfoBubble.prototype.panToView, InfoBubble.prototype.htmlToDocumentFragment_ = function (t) { t = t.replace(/^\s*([\S\s]*)\b\s*$/, "$1"); var e = document.createElement("DIV"); if (e.innerHTML = t, 1 == e.childNodes.length) return e.removeChild(e.firstChild); for (var o = document.createDocumentFragment(); e.firstChild;) o.appendChild(e.firstChild); return o }, InfoBubble.prototype.removeChildren_ = function (t) { if (t) for (var e; e = t.firstChild;) t.removeChild(e) }, InfoBubble.prototype.setContent = function (t) { this.set("content", t) }, InfoBubble.prototype.setContent = InfoBubble.prototype.setContent, InfoBubble.prototype.getContent = function () { return this.get("content") }, InfoBubble.prototype.getContent = InfoBubble.prototype.getContent, InfoBubble.prototype.updateContent_ = function () { if (this.content_) { this.removeChildren_(this.content_); var t = this.getContent(); if (t) { "string" == typeof t && (t = this.htmlToDocumentFragment_(t)), this.content_.appendChild(t); for (var e, o = this, i = this.content_.getElementsByTagName("IMG"), n = 0; e = i[n]; n++) google.maps.event.addDomListener(e, "load", function () { o.imageLoaded_() }); google.maps.event.trigger(this, "domready") } this.redraw_() } }, InfoBubble.prototype.imageLoaded_ = function () { var t = !this.get("disableAutoPan"); this.redraw_(), !t || 0 != this.tabs_.length && 0 != this.activeTab_.index || this.panToView() }, InfoBubble.prototype.updateTabStyles_ = function () { if (this.tabs_ && this.tabs_.length) { for (var t, e = 0; t = this.tabs_[e]; e++) this.setTabStyle_(t.tab); this.activeTab_.style.zIndex = this.baseZIndex_; var o = this.getBorderWidth_(), i = this.getPadding_() / 2; this.activeTab_.style.borderBottomWidth = 0, this.activeTab_.style.paddingBottom = this.px(i + o) } }, InfoBubble.prototype.setTabStyle_ = function (t) { var e = this.get("backgroundColor"), o = this.get("borderColor"), i = this.getBorderRadius_(), n = this.getBorderWidth_(), s = this.getPadding_(), r = this.px(-Math.max(s, i)), a = this.px(i), b = this.baseZIndex_; t.index && (b -= t.index); var h = { cssFloat: "left", position: "relative", cursor: "pointer", backgroundColor: e, border: this.px(n) + " solid " + o, padding: this.px(s / 2) + " " + this.px(s), marginRight: r, whiteSpace: "nowrap", borderRadiusTopLeft: a, MozBorderRadiusTopleft: a, webkitBorderTopLeftRadius: a, borderRadiusTopRight: a, MozBorderRadiusTopright: a, webkitBorderTopRightRadius: a, zIndex: b, display: "inline" }; for (var l in h) t.style[l] = h[l]; var p = this.get("tabClassName"); void 0 != p && (t.className += " " + p) }, InfoBubble.prototype.addTabActions_ = function (t) { var e = this; t.listener_ = google.maps.event.addDomListener(t, "click", function () { e.setTabActive_(this) }) }, InfoBubble.prototype.setTabActive = function (t) { var e = this.tabs_[t - 1]; e && this.setTabActive_(e.tab) }, InfoBubble.prototype.setTabActive = InfoBubble.prototype.setTabActive, InfoBubble.prototype.setTabActive_ = function (t) { if (!t) return this.setContent(""), void this.updateContent_(); var e = this.getPadding_() / 2, o = this.getBorderWidth_(); if (this.activeTab_) { var i = this.activeTab_; i.style.zIndex = this.baseZIndex_ - i.index, i.style.paddingBottom = this.px(e), i.style.borderBottomWidth = this.px(o) } t.style.zIndex = this.baseZIndex_, t.style.borderBottomWidth = 0, t.style.marginBottomWidth = "-10px", t.style.paddingBottom = this.px(e + o), this.setContent(this.tabs_[t.index].content), this.updateContent_(), this.activeTab_ = t, this.redraw_() }, InfoBubble.prototype.setMaxWidth = function (t) { this.set("maxWidth", t) }, InfoBubble.prototype.setMaxWidth = InfoBubble.prototype.setMaxWidth, InfoBubble.prototype.maxWidth_changed = function () { this.redraw_() }, InfoBubble.prototype.maxWidth_changed = InfoBubble.prototype.maxWidth_changed, InfoBubble.prototype.setMaxHeight = function (t) { this.set("maxHeight", t) }, InfoBubble.prototype.setMaxHeight = InfoBubble.prototype.setMaxHeight, InfoBubble.prototype.maxHeight_changed = function () { this.redraw_() }, InfoBubble.prototype.maxHeight_changed = InfoBubble.prototype.maxHeight_changed, InfoBubble.prototype.setMinWidth = function (t) { this.set("minWidth", t) }, InfoBubble.prototype.setMinWidth = InfoBubble.prototype.setMinWidth, InfoBubble.prototype.minWidth_changed = function () { this.redraw_() }, InfoBubble.prototype.minWidth_changed = InfoBubble.prototype.minWidth_changed, InfoBubble.prototype.setMinHeight = function (t) { this.set("minHeight", t) }, InfoBubble.prototype.setMinHeight = InfoBubble.prototype.setMinHeight, InfoBubble.prototype.minHeight_changed = function () { this.redraw_() }, InfoBubble.prototype.minHeight_changed = InfoBubble.prototype.minHeight_changed, InfoBubble.prototype.addTab = function (t, e) { var o = document.createElement("DIV"); o.innerHTML = t, this.setTabStyle_(o), this.addTabActions_(o), this.tabsContainer_.appendChild(o), this.tabs_.push({ label: t, content: e, tab: o }), o.index = this.tabs_.length - 1, o.style.zIndex = this.baseZIndex_ - o.index, this.activeTab_ || this.setTabActive_(o), o.className = o.className + " " + this.animationName_, this.redraw_() }, InfoBubble.prototype.addTab = InfoBubble.prototype.addTab, InfoBubble.prototype.updateTab = function (t, e, o) { if (!(!this.tabs_.length || 0 > t || t >= this.tabs_.length)) { var i = this.tabs_[t]; void 0 != e && (i.tab.innerHTML = i.label = e), void 0 != o && (i.content = o), this.activeTab_ == i.tab && (this.setContent(i.content), this.updateContent_()), this.redraw_() } }, InfoBubble.prototype.updateTab = InfoBubble.prototype.updateTab, InfoBubble.prototype.removeTab = function (t) { if (!(!this.tabs_.length || 0 > t || t >= this.tabs_.length)) { var e = this.tabs_[t]; e.tab.parentNode.removeChild(e.tab), google.maps.event.removeListener(e.tab.listener_), this.tabs_.splice(t, 1), delete e; for (var o, i = 0; o = this.tabs_[i]; i++) o.tab.index = i; e.tab == this.activeTab_ && (this.activeTab_ = this.tabs_[t] ? this.tabs_[t].tab : this.tabs_[t - 1] ? this.tabs_[t - 1].tab : void 0, this.setTabActive_(this.activeTab_)), this.redraw_() } }, InfoBubble.prototype.removeTab = InfoBubble.prototype.removeTab, InfoBubble.prototype.getElementSize_ = function (t, e, o) { var i = document.createElement("DIV"); i.style.display = "inline", i.style.position = "absolute", i.style.visibility = "hidden", "string" == typeof t ? i.innerHTML = t : i.appendChild(t.cloneNode(!0)), document.body.appendChild(i); var n = new google.maps.Size(i.offsetWidth, i.offsetHeight); return e && n.width > e && (i.style.width = this.px(e), n = new google.maps.Size(i.offsetWidth, i.offsetHeight)), o && n.height > o && (i.style.height = this.px(o), n = new google.maps.Size(i.offsetWidth, i.offsetHeight)), document.body.removeChild(i), delete i, n }, InfoBubble.prototype.redraw_ = function () { this.figureOutSize_(), this.positionCloseButton_(), this.draw() }, InfoBubble.prototype.figureOutSize_ = function () { var t = this.get("map"); if (t) { var e = this.getPadding_(), o = (this.getBorderWidth_(), this.getBorderRadius_(), this.getArrowSize_()), i = t.getDiv(), n = 2 * o, s = i.offsetWidth - n, r = i.offsetHeight - n - this.getAnchorHeight_(), a = 0, b = this.get("minWidth") || 0, h = this.get("minHeight") || 0, l = this.get("maxWidth") || 0, p = this.get("maxHeight") || 0; l = Math.min(s, l), p = Math.min(r, p); var d = 0; if (this.tabs_.length) for (var u, f = 0; u = this.tabs_[f]; f++) { var y = this.getElementSize_(u.tab, l, p), _ = this.getElementSize_(u.content, l, p); b < y.width && (b = y.width), d += y.width, h < y.height && (h = y.height), y.height > a && (a = y.height), b < _.width && (b = _.width), h < _.height && (h = _.height) } else { var c = this.get("content"); if ("string" == typeof c && (c = this.htmlToDocumentFragment_(c)), c) { var _ = this.getElementSize_(c, l, p); b < _.width && (b = _.width), h < _.height && (h = _.height) } } l && (b = Math.min(b, l)), p && (h = Math.min(h, p)), b = Math.max(b, d), b == d && (b += 2 * e), o = 2 * o, b = Math.max(b, o), b > s && (b = s), h > r && (h = r - a), this.tabsContainer_ && (this.tabHeight_ = a, this.tabsContainer_.style.width = this.px(d)), this.contentContainer_.style.width = this.px(b), this.contentContainer_.style.height = this.px(h) } }, InfoBubble.prototype.getAnchorHeight_ = function () { var t = this.get("anchor"); if (t) { var e = this.get("anchorPoint"); if (e) return -1 * e.y } return 0 }, InfoBubble.prototype.anchorPoint_changed = function () { this.draw() }, InfoBubble.prototype.anchorPoint_changed = InfoBubble.prototype.anchorPoint_changed, InfoBubble.prototype.positionCloseButton_ = function () { var t = (this.getBorderRadius_(), this.getBorderWidth_()), e = this.get("offsetRight"), o = this.get("offsetTop"); this.tabs_.length && this.tabHeight_ && (o += this.tabHeight_), void 0 == e && (e = this.OFFSET_RIGHT_), void 0 == o && (o = this.OFFSET_TOP_), o += t, e += t; var i = this.contentContainer_; i && i.clientHeight < i.scrollHeight && (e += 15), this.close_.style.right = this.px(e), this.close_.style.top = this.px(o) };
        function ClusterIcon(t, e) { t.getMarkerClusterer().extend(ClusterIcon, google.maps.OverlayView), this.cluster_ = t, this.className_ = t.getMarkerClusterer().getClusterClass(), this.styles_ = e, this.center_ = null, this.div_ = null, this.sums_ = null, this.visible_ = !1, this.setMap(t.getMap()) } function Cluster(t) { this.markerClusterer_ = t, this.map_ = t.getMap(), this.gridSize_ = t.getGridSize(), this.minClusterSize_ = t.getMinimumClusterSize(), this.averageCenter_ = t.getAverageCenter(), this.hideLabel_ = t.getHideLabel(), this.markers_ = [], this.center_ = null, this.bounds_ = null, this.clusterIcon_ = new ClusterIcon(this, t.getStyles()) } function MarkerClusterer(t, e, r) { this.extend(MarkerClusterer, google.maps.OverlayView), e = e || [], r = r || {}, this.markers_ = [], this.clusters_ = [], this.listeners_ = [], this.activeMap_ = null, this.ready_ = !1, this.gridSize_ = r.gridSize || 60, this.minClusterSize_ = r.minimumClusterSize || 2, this.maxZoom_ = r.maxZoom || null, this.styles_ = r.styles || [], this.title_ = r.title || "", this.zoomOnClick_ = !0, void 0 !== r.zoomOnClick && (this.zoomOnClick_ = r.zoomOnClick), this.averageCenter_ = !1, void 0 !== r.averageCenter && (this.averageCenter_ = r.averageCenter), this.ignoreHidden_ = !1, void 0 !== r.ignoreHidden && (this.ignoreHidden_ = r.ignoreHidden), this.enableRetinaIcons_ = !1, void 0 !== r.enableRetinaIcons && (this.enableRetinaIcons_ = r.enableRetinaIcons), this.hideLabel_ = !1, void 0 !== r.hideLabel && (this.hideLabel_ = r.hideLabel), this.imagePath_ = r.imagePath || MarkerClusterer.IMAGE_PATH, this.imageExtension_ = r.imageExtension || MarkerClusterer.IMAGE_EXTENSION, this.imageSizes_ = r.imageSizes || MarkerClusterer.IMAGE_SIZES, this.calculator_ = r.calculator || MarkerClusterer.CALCULATOR, this.batchSize_ = r.batchSize || MarkerClusterer.BATCH_SIZE, this.batchSizeIE_ = r.batchSizeIE || MarkerClusterer.BATCH_SIZE_IE, this.clusterClass_ = r.clusterClass || "cluster", -1 !== navigator.userAgent.toLowerCase().indexOf("msie") && (this.batchSize_ = this.batchSizeIE_), this.setupStyles_(), this.addMarkers(e, !0), this.setMap(t) } ClusterIcon.prototype.onAdd = function () { var t, e, r = this; this.div_ = document.createElement("div"), this.div_.className = this.className_, this.visible_ && this.show(), this.getPanes().overlayMouseTarget.appendChild(this.div_), this.boundsChangedListener_ = google.maps.event.addListener(this.getMap(), "bounds_changed", function () { e = t }), google.maps.event.addDomListener(this.div_, "mousedown", function () { t = !0, e = !1 }), google.maps.event.addDomListener(this.div_, "click", function (s) { if (t = !1, !e) { var i, o, n = r.cluster_.getMarkerClusterer(); google.maps.event.trigger(n, "click", r.cluster_), google.maps.event.trigger(n, "clusterclick", r.cluster_), n.getZoomOnClick() && (o = n.getMaxZoom(), i = r.cluster_.getBounds(), n.getMap().fitBounds(i), setTimeout(function () { n.getMap().fitBounds(i), null !== o && n.getMap().getZoom() > o && n.getMap().setZoom(o + 1) }, 100)), s.cancelBubble = !0, s.stopPropagation && s.stopPropagation() } }), google.maps.event.addDomListener(this.div_, "mouseover", function () { var t = r.cluster_.getMarkerClusterer(); google.maps.event.trigger(t, "mouseover", r.cluster_) }), google.maps.event.addDomListener(this.div_, "mouseout", function () { var t = r.cluster_.getMarkerClusterer(); google.maps.event.trigger(t, "mouseout", r.cluster_) }) }, ClusterIcon.prototype.onRemove = function () { this.div_ && this.div_.parentNode && (this.hide(), google.maps.event.removeListener(this.boundsChangedListener_), google.maps.event.clearInstanceListeners(this.div_), this.div_.parentNode.removeChild(this.div_), this.div_ = null) }, ClusterIcon.prototype.draw = function () { if (this.visible_) { var t = this.getPosFromLatLng_(this.center_); this.div_.style.top = t.y + "px", this.div_.style.left = t.x + "px" } }, ClusterIcon.prototype.hide = function () { this.div_ && (this.div_.style.display = "none"), this.visible_ = !1 }, ClusterIcon.prototype.show = function () { if (this.div_) { var t = "", e = this.backgroundPosition_.split(" "), r = parseInt(e[0].trim(), 10), s = parseInt(e[1].trim(), 10), i = this.getPosFromLatLng_(this.center_); this.div_.style.cssText = this.createCss(i), t = "<img src='" + this.url_ + "' style='position: absolute; top: " + s + "px; left: " + r + "px; ", t += this.cluster_.getMarkerClusterer().enableRetinaIcons_ ? "width: " + this.width_ + "px;height: " + this.height_ + "px;" : "clip: rect(" + -1 * s + "px, " + (-1 * r + this.width_) + "px, " + (-1 * s + this.height_) + "px, " + -1 * r + "px);", t += "'>", this.div_.innerHTML = t + "<div style='position: absolute;top: " + this.anchorText_[0] + "px;left: " + this.anchorText_[1] + "px;color: " + this.textColor_ + ";font-size: " + this.textSize_ + "px;font-family: " + this.fontFamily_ + ";font-weight: " + this.fontWeight_ + ";font-style: " + this.fontStyle_ + ";text-decoration: " + this.textDecoration_ + ";text-align: center;width: " + this.width_ + "px;line-height:" + this.height_ + "px;'>" + (this.cluster_.hideLabel_ ? " " : this.sums_.text) + "</div>", "undefined" == typeof this.sums_.title || "" === this.sums_.title ? this.div_.title = this.cluster_.getMarkerClusterer().getTitle() : this.div_.title = this.sums_.title, this.div_.style.display = "" } this.visible_ = !0 }, ClusterIcon.prototype.useStyle = function (t) { this.sums_ = t; var e = Math.max(0, t.index - 1); e = Math.min(this.styles_.length - 1, e); var r = this.styles_[e]; this.url_ = r.url, this.height_ = r.height, this.width_ = r.width, this.anchorText_ = r.anchorText || [0, 0], this.anchorIcon_ = r.anchorIcon || [parseInt(this.height_ / 2, 10), parseInt(this.width_ / 2, 10)], this.textColor_ = r.textColor || "black", this.textSize_ = r.textSize || 11, this.textDecoration_ = r.textDecoration || "none", this.fontWeight_ = r.fontWeight || "bold", this.fontStyle_ = r.fontStyle || "normal", this.fontFamily_ = r.fontFamily || "Arial,sans-serif", this.backgroundPosition_ = r.backgroundPosition || "0 0" }, ClusterIcon.prototype.setCenter = function (t) { this.center_ = t }, ClusterIcon.prototype.createCss = function (t) { var e = []; return e.push("cursor: pointer;"), e.push("position: absolute; top: " + t.y + "px; left: " + t.x + "px;"), e.push("width: " + this.width_ + "px; height: " + this.height_ + "px;"), e.join("") }, ClusterIcon.prototype.getPosFromLatLng_ = function (t) { var e = this.getProjection().fromLatLngToDivPixel(t); return e.x -= this.anchorIcon_[1], e.y -= this.anchorIcon_[0], e.x = parseInt(e.x, 10), e.y = parseInt(e.y, 10), e }, Cluster.prototype.getSize = function () { return this.markers_.length }, Cluster.prototype.getMarkers = function () { return this.markers_ }, Cluster.prototype.getCenter = function () { return this.center_ }, Cluster.prototype.getMap = function () { return this.map_ }, Cluster.prototype.getMarkerClusterer = function () { return this.markerClusterer_ }, Cluster.prototype.getBounds = function () { var t, e = new google.maps.LatLngBounds(this.center_, this.center_), r = this.getMarkers(); for (t = 0; t < r.length; t++) e.extend(r[t].getPosition()); return e }, Cluster.prototype.remove = function () { this.clusterIcon_.setMap(null), this.markers_ = [], delete this.markers_ }, Cluster.prototype.addMarker = function (t) { var e, r, s; if (this.isMarkerAlreadyAdded_(t)) return !1; if (this.center_) { if (this.averageCenter_) { var i = this.markers_.length + 1, o = (this.center_.lat() * (i - 1) + t.getPosition().lat()) / i, n = (this.center_.lng() * (i - 1) + t.getPosition().lng()) / i; this.center_ = new google.maps.LatLng(o, n), this.calculateBounds_() } } else this.center_ = t.getPosition(), this.calculateBounds_(); if (t.isAdded = !0, this.markers_.push(t), r = this.markers_.length, s = this.markerClusterer_.getMaxZoom(), null !== s && this.map_.getZoom() > s) t.getMap() !== this.map_ && t.setMap(this.map_); else if (r < this.minClusterSize_) t.getMap() !== this.map_ && t.setMap(this.map_); else if (r === this.minClusterSize_) for (e = 0; r > e; e++) this.markers_[e].setMap(null); else t.setMap(null); return !0 }, Cluster.prototype.isMarkerInClusterBounds = function (t) { return this.bounds_.contains(t.getPosition()) }, Cluster.prototype.calculateBounds_ = function () { var t = new google.maps.LatLngBounds(this.center_, this.center_); this.bounds_ = this.markerClusterer_.getExtendedBounds(t) }, Cluster.prototype.updateIcon_ = function () { var t = this.markers_.length, e = this.markerClusterer_.getMaxZoom(); if (null !== e && this.map_.getZoom() > e) return void this.clusterIcon_.hide(); if (t < this.minClusterSize_) return void this.clusterIcon_.hide(); var r = this.markerClusterer_.getStyles().length, s = this.markerClusterer_.getCalculator()(this.markers_, r); this.clusterIcon_.setCenter(this.center_), this.clusterIcon_.useStyle(s), this.clusterIcon_.show() }, Cluster.prototype.isMarkerAlreadyAdded_ = function (t) { for (var e = 0, r = this.markers_.length; r > e; e++) if (t === this.markers_[e]) return !0; return !1 }, MarkerClusterer.prototype.onAdd = function () { var t = this; this.activeMap_ = this.getMap(), this.ready_ = !0, this.repaint(), this.listeners_ = [google.maps.event.addListener(this.getMap(), "zoom_changed", function () { t.resetViewport_(!1), (this.getZoom() === (this.get("minZoom") || 0) || this.getZoom() === this.get("maxZoom")) && google.maps.event.trigger(this, "idle") }), google.maps.event.addListener(this.getMap(), "idle", function () { t.redraw_() })] }, MarkerClusterer.prototype.onRemove = function () { var t; for (t = 0; t < this.markers_.length; t++) this.markers_[t].getMap() !== this.activeMap_ && this.markers_[t].setMap(this.activeMap_); for (t = 0; t < this.clusters_.length; t++) this.clusters_[t].remove(); for (this.clusters_ = [], t = 0; t < this.listeners_.length; t++) google.maps.event.removeListener(this.listeners_[t]); this.listeners_ = [], this.activeMap_ = null, this.ready_ = !1 }, MarkerClusterer.prototype.draw = function () { }, MarkerClusterer.prototype.setupStyles_ = function () { var t, e; if (!(this.styles_.length > 0)) for (t = 0; t < this.imageSizes_.length; t++) e = this.imageSizes_[t], this.styles_.push({ url: this.imagePath_ + (t + 1) + "." + this.imageExtension_, height: e, width: e }) }, MarkerClusterer.prototype.fitMapToMarkers = function () { var t, e = this.getMarkers(), r = new google.maps.LatLngBounds; for (t = 0; t < e.length; t++) r.extend(e[t].getPosition()); this.getMap().fitBounds(r) }, MarkerClusterer.prototype.getGridSize = function () { return this.gridSize_ }, MarkerClusterer.prototype.setGridSize = function (t) { this.gridSize_ = t }, MarkerClusterer.prototype.getMinimumClusterSize = function () { return this.minClusterSize_ }, MarkerClusterer.prototype.setMinimumClusterSize = function (t) { this.minClusterSize_ = t }, MarkerClusterer.prototype.getMaxZoom = function () { return this.maxZoom_ }, MarkerClusterer.prototype.setMaxZoom = function (t) { this.maxZoom_ = t }, MarkerClusterer.prototype.getStyles = function () { return this.styles_ }, MarkerClusterer.prototype.setStyles = function (t) { this.styles_ = t }, MarkerClusterer.prototype.getTitle = function () { return this.title_ }, MarkerClusterer.prototype.setTitle = function (t) { this.title_ = t }, MarkerClusterer.prototype.getZoomOnClick = function () { return this.zoomOnClick_ }, MarkerClusterer.prototype.setZoomOnClick = function (t) { this.zoomOnClick_ = t }, MarkerClusterer.prototype.getAverageCenter = function () { return this.averageCenter_ }, MarkerClusterer.prototype.setAverageCenter = function (t) { this.averageCenter_ = t }, MarkerClusterer.prototype.getIgnoreHidden = function () { return this.ignoreHidden_ }, MarkerClusterer.prototype.setIgnoreHidden = function (t) { this.ignoreHidden_ = t }, MarkerClusterer.prototype.getEnableRetinaIcons = function () { return this.enableRetinaIcons_ }, MarkerClusterer.prototype.setEnableRetinaIcons = function (t) { this.enableRetinaIcons_ = t }, MarkerClusterer.prototype.getImageExtension = function () { return this.imageExtension_ }, MarkerClusterer.prototype.setImageExtension = function (t) { this.imageExtension_ = t }, MarkerClusterer.prototype.getImagePath = function () { return this.imagePath_ }, MarkerClusterer.prototype.setImagePath = function (t) { this.imagePath_ = t }, MarkerClusterer.prototype.getImageSizes = function () { return this.imageSizes_ }, MarkerClusterer.prototype.setImageSizes = function (t) { this.imageSizes_ = t }, MarkerClusterer.prototype.getCalculator = function () { return this.calculator_ }, MarkerClusterer.prototype.setCalculator = function (t) { this.calculator_ = t }, MarkerClusterer.prototype.setHideLabel = function (t) { this.hideLabel_ = t }, MarkerClusterer.prototype.getHideLabel = function () { return this.hideLabel_ }, MarkerClusterer.prototype.getBatchSizeIE = function () { return this.batchSizeIE_ }, MarkerClusterer.prototype.setBatchSizeIE = function (t) { this.batchSizeIE_ = t }, MarkerClusterer.prototype.getClusterClass = function () { return this.clusterClass_ }, MarkerClusterer.prototype.setClusterClass = function (t) { this.clusterClass_ = t }, MarkerClusterer.prototype.getMarkers = function () { return this.markers_ }, MarkerClusterer.prototype.getTotalMarkers = function () { return this.markers_.length }, MarkerClusterer.prototype.getClusters = function () { return this.clusters_ }, MarkerClusterer.prototype.getTotalClusters = function () { return this.clusters_.length }, MarkerClusterer.prototype.addMarker = function (t, e) { this.pushMarkerTo_(t), e || this.redraw_() }, MarkerClusterer.prototype.addMarkers = function (t, e) { var r; for (r in t) t.hasOwnProperty(r) && this.pushMarkerTo_(t[r]); e || this.redraw_() }, MarkerClusterer.prototype.pushMarkerTo_ = function (t) { if (t.getDraggable()) { var e = this; google.maps.event.addListener(t, "dragend", function () { e.ready_ && (this.isAdded = !1, e.repaint()) }) } t.isAdded = !1, this.markers_.push(t) }, MarkerClusterer.prototype.removeMarker = function (t, e, r) { var s = !r, i = this.removeMarker_(t, s); return !e && i && this.repaint(), i }, MarkerClusterer.prototype.removeMarkers = function (t, e, r) { var s, i, o = !1, n = !r; for (s = 0; s < t.length; s++) i = this.removeMarker_(t[s], n), o = o || i; return !e && o && this.repaint(), o }, MarkerClusterer.prototype.removeMarker_ = function (t, e) { var r, s = -1; if (this.markers_.indexOf) s = this.markers_.indexOf(t); else for (r = 0; r < this.markers_.length; r++) if (t === this.markers_[r]) { s = r; break } return -1 === s ? !1 : (e && t.setMap(null), this.markers_.splice(s, 1), !0) }, MarkerClusterer.prototype.clearMarkers = function () { this.resetViewport_(!0), this.markers_ = [] }, MarkerClusterer.prototype.repaint = function () { var t = this.clusters_.slice(); this.clusters_ = [], this.resetViewport_(!1), this.redraw_(), setTimeout(function () { var e; for (e = 0; e < t.length; e++) t[e].remove() }, 0) }, MarkerClusterer.prototype.getExtendedBounds = function (t) { var e = this.getProjection(), r = new google.maps.LatLng(t.getNorthEast().lat(), t.getNorthEast().lng()), s = new google.maps.LatLng(t.getSouthWest().lat(), t.getSouthWest().lng()), i = e.fromLatLngToDivPixel(r); i.x += this.gridSize_, i.y -= this.gridSize_; var o = e.fromLatLngToDivPixel(s); o.x -= this.gridSize_, o.y += this.gridSize_; var n = e.fromDivPixelToLatLng(i), a = e.fromDivPixelToLatLng(o); return t.extend(n), t.extend(a), t }, MarkerClusterer.prototype.redraw_ = function () { this.createClusters_(0) }, MarkerClusterer.prototype.resetViewport_ = function (t) { var e, r; for (e = 0; e < this.clusters_.length; e++) this.clusters_[e].remove(); for (this.clusters_ = [], e = 0; e < this.markers_.length; e++) r = this.markers_[e], r.isAdded = !1, t && r.setMap(null) }, MarkerClusterer.prototype.distanceBetweenPoints_ = function (t, e) { var r = 6371, s = (e.lat() - t.lat()) * Math.PI / 180, i = (e.lng() - t.lng()) * Math.PI / 180, o = Math.sin(s / 2) * Math.sin(s / 2) + Math.cos(t.lat() * Math.PI / 180) * Math.cos(e.lat() * Math.PI / 180) * Math.sin(i / 2) * Math.sin(i / 2), n = 2 * Math.atan2(Math.sqrt(o), Math.sqrt(1 - o)), a = r * n; return a }, MarkerClusterer.prototype.isMarkerInBounds_ = function (t, e) { return e.contains(t.getPosition()) }, MarkerClusterer.prototype.addToClosestCluster_ = function (t) { var e, r, s, i, o = 4e4, n = null; for (e = 0; e < this.clusters_.length; e++) s = this.clusters_[e], i = s.getCenter(), i && (r = this.distanceBetweenPoints_(i, t.getPosition()), o > r && (o = r, n = s)); n && n.isMarkerInClusterBounds(t) ? n.addMarker(t) : (s = new Cluster(this), s.addMarker(t), this.clusters_.push(s)) }, MarkerClusterer.prototype.createClusters_ = function (t) { var e, r, s, i = this; if (this.ready_) { 0 === t && (google.maps.event.trigger(this, "clusteringbegin", this), "undefined" != typeof this.timerRefStatic && (clearTimeout(this.timerRefStatic), delete this.timerRefStatic)), s = this.getMap().getZoom() > 3 ? new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(), this.getMap().getBounds().getNorthEast()) : new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472, -178.48388434375), new google.maps.LatLng(-85.08136444384544, 178.00048865625)); var o = this.getExtendedBounds(s), n = Math.min(t + this.batchSize_, this.markers_.length); for (e = t; n > e; e++) r = this.markers_[e], !r.isAdded && this.isMarkerInBounds_(r, o) && (!this.ignoreHidden_ || this.ignoreHidden_ && r.getVisible()) && this.addToClosestCluster_(r); if (n < this.markers_.length) this.timerRefStatic = setTimeout(function () { i.createClusters_(n) }, 0); else for (delete this.timerRefStatic, google.maps.event.trigger(this, "clusteringend", this), e = 0; e < this.clusters_.length; e++) this.clusters_[e].updateIcon_() } }, MarkerClusterer.prototype.extend = function (t, e) { return function (t) { var e; for (e in t.prototype) this.prototype[e] = t.prototype[e]; return this }.apply(t, [e]) }, MarkerClusterer.CALCULATOR = function (t, e) { for (var r = 0, s = "", i = t.length.toString(), o = i; 0 !== o;) o = parseInt(o / 10, 10), r++; return r = Math.min(r, e), { text: i, index: r, title: s } }, MarkerClusterer.BATCH_SIZE = 2e3, MarkerClusterer.BATCH_SIZE_IE = 500, MarkerClusterer.IMAGE_PATH = "//cdn.rawgit.com/mahnunchik/markerclustererplus/master/images/m", MarkerClusterer.IMAGE_EXTENSION = "png", MarkerClusterer.IMAGE_SIZES = [53, 56, 66, 78, 90], "function" != typeof String.prototype.trim && (String.prototype.trim = function () { return this.replace(/^\s+|\s+$/g, "") });

    </script>

    <script type="text/javascript">
        (function () {
            var pkp = document.createElement('script'); pkp.type = 'text/javascript'; pkp.async = true;
            pkp.src = 'https://pickuppoint.co.il/api/ups-pickups.sdk.all.js?r=2.0';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(pkp, s);
        })();

    </script>
    <script>
        (function ($) {

            $.fn.serializeFormJSON = function () {

                var o = {};

                var a = this.serializeArray();

                $.each(a, function () {

                    if (o[this.name]) {

                        if (!o[this.name].push) {

                            o[this.name] = [o[this.name]];

                        }

                        o[this.name].push(this.value || '');

                    } else {

                        o[this.name] = this.value || '';

                    }

                });

                return o;

            };

        })(jQuery);
        jQuery(document).ready(function ($) {
            $(document.body).on('pickups-before-open', function () {

                var o = new Object();
                o.form = jQuery("form[name='checkout']").serializeFormJSON();
                o.location = new Object();
                o.location.city = o.form.billing_city;
                o.location.street = o.form.billing_street;
                var json = JSON.stringify(o);
                window.PickupsSDK.setDefaults(json);
            });
        });

        jQuery(document).ready(function ($) {

            $(document.body).on('pickups-after-choosen', function (e, data) {

                pkps_location = e.originalEvent.detail;

                console.log("pickups-after-choosen catched event", pkps_location);

                jQuery("input[name=pickups_location1]").val(pkps_location.iid);

                jQuery("input[name=pickups_location2]").val(JSON.stringify(pkps_location));

                console.log(jQuery("input[name=pickups_location1]").val());
                pickup_render_description(pkps_location);

            });
        });
        // Pickup location chosen select on page load and checkout updated
        jQuery(document).ready(function ($) {

            $(document.body).on('updated_checkout', function () {

                var obj = jQuery("input[name=pickups_location2]");
                console.log("updated_checkout for pickup has been raised...", obj);
                if (typeof (obj) != "undefined") {
                    var json = obj.val();
                    if (typeof (json) != "undefined" && json.length > 0) {
                        var o = JSON.parse(json);
                        if (o != "undefined") {
                            pickup_render_description(o);
                        }
                    }

                }

            });
        });
        function pickup_render_description(pkps_location) {
            var html = "<br /><b>" + pkps_location.title + "</b>&nbsp;(" + pkps_location.iid + ")<br />" + pkps_location.city + ", " + pkps_location.street + "<br /><small>" + pkps_location.zip + "</small>";
            jQuery("div.ups-pickups-info").css("line-height", "1em").css("font-weight", "300").css("font-size", "0.9em").html(html);
        }
    </script>

</head>


<body>

    <div onclick="window.PickupsSDK.onClick (); return;" class="ups-pickups ups-pickups-48">
    </div>
    <div class="ups-pickups-info"> </div>



    <script type="text/javascript">(function () {
            var pkp = document.createElement('script'); pkp.type = 'text / javascript'; pkp.async = true;
            pkp.src = 'https://pick-ups.co.il/api/ups-pickups.sdk.js?r=1.2';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(pkp, s);
        })();
    </script>

</body>

</html>